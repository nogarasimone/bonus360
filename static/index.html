<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BonusPerMe — Scopri i bonus a cui hai diritto</title>
  <link rel="stylesheet" href="/fonts/fonts.css">
  {{if .TurnstileSiteKey}}<script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>{{end}}
  <!-- Google Tag Manager (loads only after cookie consent) -->
  <script>
    var __GTM_ID__='{{.GTMID}}';
    function loadGTM(){if(!__GTM_ID__||window._gtmLoaded)return;window._gtmLoaded=true;
    (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});
    var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';
    j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer',__GTM_ID__);}
    if(localStorage.getItem('cookie_consent')==='accepted'){loadGTM();}
  </script>
  <style>
    /* ============================================
       BONUSPERME — DESIGN SYSTEM v2
       Warm Institutional + Icons + Flag Dropdown
       ============================================ */

    *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

    :root {
      --ink: #1C1C1F;
      --ink-75: #404045;
      --ink-50: #76767C;
      --ink-30: #A8A8AD;
      --ink-15: #D4D4D7;
      --ink-05: #F0F0F1;

      --warm-white: #FAFAF7;
      --warm-cream: #F4F3EE;
      --warm-sand: #EAE8E0;

      --blue: #1B3A54;
      --blue-mid: #2D5F8A;
      --blue-light: #E6EEF4;
      --blue-glow: #D0E2F0;

      --terra: #C0522E;
      --terra-dark: #9E3F20;
      --terra-light: #FAF0EB;
      --terra-glow: #F5DDD1;

      --green: #2A6B45;
      --green-light: #E8F3EC;

      --amber: #9A7B2E;
      --amber-light: #FBF5E6;

      --radius: 5px;
      --radius-lg: 8px;
      --shadow-subtle: 0 1px 2px rgba(0,0,0,0.04);
      --shadow-card: 0 1px 3px rgba(0,0,0,0.05), 0 4px 16px rgba(0,0,0,0.04);
      --shadow-hover: 0 2px 8px rgba(0,0,0,0.08), 0 8px 24px rgba(0,0,0,0.06);
      --shadow-dropdown: 0 4px 20px rgba(0,0,0,0.12), 0 1px 3px rgba(0,0,0,0.06);

      --max-w: 1040px;
      --gutter: 24px;
    }

    html { scroll-behavior: smooth; -webkit-font-smoothing: antialiased; }

    body {
      font-family: 'DM Sans', -apple-system, BlinkMacSystemFont, sans-serif;
      font-size: 15px;
      line-height: 1.65;
      color: var(--ink);
      background: var(--warm-white);
    }

    .container { max-width: var(--max-w); margin: 0 auto; padding: 0 var(--gutter); }

    /* Typography */
    h1, h2, h3 { font-family: 'DM Serif Display', Georgia, serif; font-weight: 400; }
    h1 { font-size: clamp(2rem, 4.5vw, 2.75rem); line-height: 1.15; letter-spacing: -0.01em; color: var(--ink); }
    h2 { font-size: clamp(1.5rem, 3vw, 2rem); line-height: 1.2; color: var(--ink); }
    h3 { font-size: 1.05rem; line-height: 1.35; }

    .label {
      font-family: 'DM Sans', sans-serif;
      font-size: 0.7rem;
      font-weight: 600;
      letter-spacing: 0.1em;
      text-transform: uppercase;
    }

    a { color: var(--blue-mid); text-decoration: none; }
    a:hover { text-decoration: underline; }

    /* ============================================
       INLINE SVG ICON SYSTEM
       ============================================ */
    .icon {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 20px;
      height: 20px;
      flex-shrink: 0;
    }
    .icon svg {
      width: 100%;
      height: 100%;
    }
    .icon-sm { width: 16px; height: 16px; }
    .icon-lg { width: 24px; height: 24px; }
    .icon-xl { width: 32px; height: 32px; }

    /* ============================================
       BUTTONS
       ============================================ */
    .btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 13px 28px;
      border: none;
      border-radius: var(--radius);
      font-family: 'DM Sans', sans-serif;
      font-size: 0.88rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.15s ease;
      text-decoration: none;
    }
    .btn-primary {
      background: var(--terra);
      color: #fff;
    }
    .btn-primary:hover {
      background: var(--terra-dark);
      text-decoration: none;
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(192,82,46,0.25);
    }
    .btn-outline {
      background: transparent;
      color: var(--terra);
      border: 1.5px solid var(--terra);
    }
    .btn-outline:hover {
      background: var(--terra-light);
      text-decoration: none;
    }

    /* ============================================
       TOPBAR
       ============================================ */
    .topbar {
      background: var(--blue);
      color: rgba(255,255,255,0.85);
      font-size: 0.72rem;
      padding: 7px 0;
      text-align: center;
      letter-spacing: 0.02em;
    }
    .topbar span { opacity: 0.5; margin: 0 8px; }

    /* ============================================
       HEADER
       ============================================ */
    .header {
      background: #fff;
      border-bottom: 1px solid var(--ink-15);
      position: sticky;
      top: 0;
      z-index: 100;
    }
    .header-inner {
      display: flex;
      align-items: center;
      justify-content: space-between;
      height: 54px;
    }
    .header-left {
      display: flex;
      align-items: center;
      gap: 14px;
    }
    .logo {
      display: flex;
      align-items: center;
      gap: 8px;
      text-decoration: none;
      color: var(--ink);
    }
    .logo-mark {
      width: 26px;
      height: 26px;
      background: var(--blue);
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #fff;
      font-family: 'DM Serif Display', serif;
      font-size: 14px;
      line-height: 1;
    }
    .logo-text {
      font-family: 'DM Sans', sans-serif;
      font-weight: 600;
      font-size: 0.95rem;
      letter-spacing: -0.01em;
    }
    .header-badges {
      display: flex;
      gap: 8px;
      padding-left: 14px;
      border-left: 1px solid var(--ink-15);
    }
    .header-badge {
      display: flex;
      align-items: center;
      gap: 4px;
      font-size: 0.62rem;
      font-weight: 600;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      color: var(--ink-30);
    }
    .header-badge .icon { width: 12px; height: 12px; color: var(--ink-30); }

    .header-right {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    /* ============================================
       LANGUAGE DROPDOWN WITH FLAGS
       ============================================ */
    .lang-dropdown-wrap {
      position: relative;
    }
    .lang-trigger {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 5px 10px;
      border: 1px solid var(--ink-15);
      border-radius: var(--radius);
      background: #fff;
      cursor: pointer;
      font-family: 'DM Sans', sans-serif;
      font-size: 0.78rem;
      font-weight: 600;
      color: var(--ink-75);
      transition: all 0.15s;
    }
    .lang-trigger:hover {
      border-color: var(--ink-30);
      background: var(--ink-05);
    }
    .lang-trigger .flag {
      width: 18px;
      height: 13px;
      border-radius: 2px;
      overflow: hidden;
      flex-shrink: 0;
      display: block;
      background-size: cover;
      background-position: center;
    }
    .lang-trigger .chevron {
      width: 10px;
      height: 10px;
      color: var(--ink-30);
      transition: transform 0.15s;
    }
    .lang-dropdown-wrap.open .lang-trigger .chevron {
      transform: rotate(180deg);
    }
    .lang-dropdown {
      display: none;
      position: absolute;
      top: calc(100% + 4px);
      right: 0;
      background: #fff;
      border: 1px solid var(--ink-15);
      border-radius: var(--radius);
      box-shadow: var(--shadow-dropdown);
      min-width: 160px;
      padding: 4px 0;
      z-index: 200;
    }
    .lang-dropdown-wrap.open .lang-dropdown {
      display: block;
    }
    .lang-option {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 7px 12px;
      cursor: pointer;
      font-size: 0.82rem;
      color: var(--ink-75);
      transition: background 0.1s;
      border: none;
      background: none;
      width: 100%;
      font-family: 'DM Sans', sans-serif;
      text-align: left;
    }
    .lang-option:hover {
      background: var(--ink-05);
    }
    .lang-option.active {
      color: var(--blue);
      font-weight: 600;
      background: var(--blue-light);
    }
    .lang-option .flag {
      width: 18px;
      height: 13px;
      border-radius: 2px;
      overflow: hidden;
      flex-shrink: 0;
      display: block;
      background-size: cover;
      background-position: center;
    }
    .lang-option .check {
      margin-left: auto;
      width: 14px;
      height: 14px;
      color: var(--blue);
      opacity: 0;
    }
    .lang-option.active .check {
      opacity: 1;
    }

    /* Flag backgrounds using inline SVGs encoded as data URIs for zero network requests */
    .flag-it { background: linear-gradient(90deg, #009246 33.3%, #fff 33.3%, #fff 66.6%, #CE2B37 66.6%); }
    .flag-en { background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 60 30'%3E%3Crect fill='%23012169' width='60' height='30'/%3E%3Cpath d='M0 0L60 30M60 0L0 30' stroke='%23fff' stroke-width='6'/%3E%3Cpath d='M0 0L60 30M60 0L0 30' stroke='%23C8102E' stroke-width='4' clip-path='polygon(30 0,60 0,30 15,60 30,30 30,0 30,30 15,0 0)'/%3E%3Cpath d='M30 0v30M0 15h60' stroke='%23fff' stroke-width='10'/%3E%3Cpath d='M30 0v30M0 15h60' stroke='%23C8102E' stroke-width='6'/%3E%3C/svg%3E") center/cover; }
    .flag-fr { background: linear-gradient(90deg, #002395 33.3%, #fff 33.3%, #fff 66.6%, #ED2939 66.6%); }
    .flag-es { background: linear-gradient(180deg, #AA151B 25%, #F1BF00 25%, #F1BF00 75%, #AA151B 75%); }
    .flag-ro { background: linear-gradient(90deg, #002B7F 33.3%, #FCD116 33.3%, #FCD116 66.6%, #CE1126 66.6%); }
    .flag-ar { background: linear-gradient(180deg, #000 33.3%, #fff 33.3%, #fff 66.6%, #007A3D 66.6%); position: relative; }
    .flag-sq { background: #E41E20; }

    /* ============================================
       HERO
       ============================================ */
    .hero {
      background: var(--warm-cream);
      padding: 72px 0 64px;
      border-bottom: 1px solid var(--warm-sand);
    }
    .hero-grid {
      display: grid;
      grid-template-columns: 1fr 380px;
      gap: 56px;
      align-items: start;
    }
    .hero-pretitle {
      color: var(--terra);
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .hero-pretitle .icon { color: var(--terra); }
    .hero h1 { margin-bottom: 20px; }
    .hero-subtitle {
      font-size: 1.02rem;
      line-height: 1.65;
      color: var(--ink-75);
      max-width: 480px;
      margin-bottom: 32px;
    }
    .hero-cta-row {
      display: flex;
      align-items: center;
      gap: 20px;
      margin-bottom: 12px;
    }
    .hero-meta {
      font-size: 0.78rem;
      color: var(--ink-50);
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .hero-meta-item {
      display: flex;
      align-items: center;
      gap: 4px;
    }
    .hero-meta-item .icon { width: 14px; height: 14px; color: var(--ink-30); }

    /* Proof card */
    .proof-card {
      background: #fff;
      border: 1px solid var(--ink-15);
      border-radius: var(--radius-lg);
      padding: 32px;
      box-shadow: var(--shadow-card);
    }
    .proof-number {
      font-family: 'JetBrains Mono', monospace;
      font-size: 2.4rem;
      font-weight: 600;
      color: var(--blue);
      line-height: 1;
      margin-bottom: 4px;
    }
    .proof-label {
      font-size: 0.82rem;
      color: var(--ink-50);
      margin-bottom: 24px;
    }
    .proof-divider {
      border: none;
      border-top: 1px solid var(--ink-15);
      margin: 0 0 24px;
    }
    .proof-quote {
      font-family: 'DM Serif Display', serif;
      font-style: italic;
      font-size: 0.95rem;
      line-height: 1.55;
      color: var(--ink-75);
      margin-bottom: 12px;
    }
    .proof-source {
      font-size: 0.7rem;
      color: var(--ink-30);
      display: flex;
      align-items: center;
      gap: 4px;
    }
    .proof-source .icon { width: 12px; height: 12px; }

    /* ============================================
       QUICK ESTIMATE
       ============================================ */
    .estimate {
      padding: 56px 0;
      background: #fff;
      border-bottom: 1px solid var(--ink-15);
    }
    .estimate-inner {
      max-width: 580px;
      margin: 0 auto;
      text-align: center;
    }
    .estimate-title {
      display: flex;
      align-items: center;
      gap: 8px;
      justify-content: center;
      margin-bottom: 4px;
    }
    .estimate-title h3 {
      font-family: 'DM Sans', sans-serif;
      font-weight: 600;
      font-size: 1.05rem;
    }
    .estimate-title .icon { color: var(--green); }
    .estimate-sub {
      font-size: 0.85rem;
      color: var(--ink-50);
      margin-bottom: 24px;
    }
    .estimate-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin-bottom: 20px;
    }
    .estimate-field label {
      display: flex;
      align-items: center;
      gap: 4px;
      font-size: 0.7rem;
      font-weight: 600;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      color: var(--ink-50);
      margin-bottom: 6px;
      text-align: left;
    }
    .estimate-field label .icon { width: 13px; height: 13px; color: var(--ink-30); }
    .estimate-field select {
      width: 100%;
      height: 42px;
      border: 1px solid var(--ink-15);
      border-radius: var(--radius);
      padding: 0 12px;
      font-family: 'DM Sans', sans-serif;
      font-size: 0.88rem;
      color: var(--ink);
      background: #fff;
      cursor: pointer;
      appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg width='10' height='6' viewBox='0 0 10 6' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 1L5 5L9 1' stroke='%2376767C' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 12px center;
    }
    .estimate-field select:focus {
      outline: none;
      border-color: var(--blue-mid);
      box-shadow: 0 0 0 3px var(--blue-glow);
    }
    .estimate-result {
      background: var(--green-light);
      border-radius: var(--radius);
      padding: 16px 24px;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 10px;
      justify-content: center;
    }
    .estimate-result .icon { color: var(--green); width: 22px; height: 22px; }
    .estimate-amount {
      font-family: 'JetBrains Mono', monospace;
      font-size: 1.4rem;
      font-weight: 600;
      color: var(--green);
    }
    .estimate-note {
      font-size: 0.72rem;
      color: var(--ink-50);
      margin-top: 12px;
    }

    /* ============================================
       HOW IT WORKS
       ============================================ */
    .how {
      padding: 80px 0;
      background: var(--warm-cream);
      border-bottom: 1px solid var(--warm-sand);
    }
    .section-header {
      margin-bottom: 48px;
    }
    .section-header h2 { margin-bottom: 8px; }
    .section-header p { font-size: 0.92rem; color: var(--ink-50); }

    .how-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 16px;
    }
    .how-card {
      background: #fff;
      border: 1px solid var(--ink-15);
      border-radius: var(--radius-lg);
      padding: 28px 24px;
      transition: box-shadow 0.2s, transform 0.2s;
    }
    .how-card:hover {
      box-shadow: var(--shadow-hover);
      transform: translateY(-2px);
    }
    .how-icon-row {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 16px;
    }
    .how-num {
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.82rem;
      font-weight: 600;
      color: var(--blue);
      opacity: 0.6;
    }
    .how-card-icon {
      width: 36px;
      height: 36px;
      border-radius: var(--radius);
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .how-card-icon.step-1 { background: var(--terra-light); color: var(--terra); }
    .how-card-icon.step-2 { background: var(--blue-light); color: var(--blue); }
    .how-card-icon.step-3 { background: var(--green-light); color: var(--green); }
    .how-card-icon.step-4 { background: var(--amber-light); color: var(--amber); }
    .how-card-icon .icon { width: 18px; height: 18px; }

    .how-card h3 {
      font-family: 'DM Sans', sans-serif;
      font-size: 0.95rem;
      font-weight: 600;
      margin-bottom: 8px;
      color: var(--ink);
    }
    .how-card p {
      font-size: 0.82rem;
      color: var(--ink-50);
      line-height: 1.55;
    }

    /* ============================================
       NEWS
       ============================================ */
    .news {
      padding: 80px 0;
      background: #fff;
      border-bottom: 1px solid var(--ink-15);
    }
    .news-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 16px;
    }
    .news-card {
      border: 1px solid var(--ink-15);
      border-radius: var(--radius-lg);
      padding: 24px;
      position: relative;
      transition: box-shadow 0.2s;
    }
    .news-card:hover { box-shadow: var(--shadow-card); }
    .news-badge {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      font-size: 0.6rem;
      font-weight: 700;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      padding: 2px 8px;
      border-radius: 3px;
      margin-bottom: 12px;
    }
    .news-badge .icon { width: 11px; height: 11px; }
    .news-badge.nuovo {
      background: var(--blue-light);
      color: var(--blue);
    }
    .news-badge.modificato {
      background: var(--amber-light);
      color: var(--amber);
    }
    .news-card h3 {
      font-family: 'DM Sans', sans-serif;
      font-weight: 600;
      font-size: 0.92rem;
      margin-bottom: 8px;
      line-height: 1.35;
    }
    .news-card p {
      font-size: 0.82rem;
      color: var(--ink-50);
      line-height: 1.55;
    }

    /* ============================================
       TESTIMONIALS
       ============================================ */
    .testimonials {
      padding: 80px 0;
      background: var(--warm-cream);
      border-bottom: 1px solid var(--warm-sand);
    }
    .testimonials-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 16px;
    }
    .test-card {
      background: #fff;
      border: 1px solid var(--ink-15);
      border-radius: var(--radius-lg);
      padding: 28px;
    }
    .test-stars {
      display: flex;
      gap: 2px;
      margin-bottom: 14px;
    }
    .test-stars .icon { width: 14px; height: 14px; color: var(--amber); }
    .test-quote {
      font-family: 'DM Serif Display', serif;
      font-style: italic;
      font-size: 0.92rem;
      line-height: 1.6;
      color: var(--ink-75);
      margin-bottom: 20px;
    }
    .test-divider {
      border: none;
      border-top: 1px solid var(--ink-15);
      margin: 0 0 16px;
    }
    .test-author {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .test-avatar {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: var(--blue-light);
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--blue);
    }
    .test-avatar .icon { width: 16px; height: 16px; }
    .test-name {
      font-weight: 600;
      font-size: 0.85rem;
      color: var(--ink);
    }
    .test-info {
      font-size: 0.75rem;
      color: var(--ink-30);
    }

    /* ============================================
       PRIVACY BAR
       ============================================ */
    .privacy {
      background: var(--blue);
      color: #fff;
      padding: 64px 0;
    }
    .privacy h2 {
      color: #fff;
      margin-bottom: 40px;
    }
    .privacy-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 32px;
    }
    .privacy-icon {
      width: 40px;
      height: 40px;
      border-radius: var(--radius);
      background: rgba(255,255,255,0.1);
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 14px;
      color: rgba(255,255,255,0.85);
    }
    .privacy-icon .icon { width: 20px; height: 20px; }
    .privacy-item h4 {
      font-family: 'DM Sans', sans-serif;
      font-weight: 600;
      font-size: 0.88rem;
      margin-bottom: 8px;
      color: #fff;
    }
    .privacy-item p {
      font-size: 0.82rem;
      line-height: 1.6;
      color: rgba(255,255,255,0.7);
    }

    /* ============================================
       CTA SECTION
       ============================================ */
    .cta-section {
      padding: 80px 0;
      text-align: center;
      background: var(--warm-cream);
      border-bottom: 1px solid var(--warm-sand);
    }
    .cta-section h2 { margin-bottom: 12px; }
    .cta-section p {
      font-size: 0.95rem;
      color: var(--ink-50);
      margin-bottom: 32px;
    }

    /* ============================================
       FOOTER
       ============================================ */
    .footer {
      background: var(--warm-cream);
      border-top: 1px solid var(--warm-sand);
      padding: 32px 0;
    }
    .footer-inner {
      display: flex;
      justify-content: space-between;
      align-items: start;
    }
    .footer-left p {
      font-size: 0.78rem;
      color: var(--ink-50);
      line-height: 1.6;
      max-width: 400px;
    }
    .footer-left .logo { margin-bottom: 12px; }
    .footer-right { text-align: right; }
    .footer-links {
      display: flex;
      gap: 16px;
      margin-bottom: 12px;
      justify-content: flex-end;
    }
    .footer-links a {
      font-size: 0.78rem;
      color: var(--ink-50);
      display: flex;
      align-items: center;
      gap: 4px;
    }
    .footer-links a .icon { width: 14px; height: 14px; }
    .footer-links a:hover { color: var(--ink); }
    .footer-badges {
      font-size: 0.68rem;
      color: var(--ink-30);
    }
    .footer-badges span { margin: 0 4px; opacity: 0.4; }

    /* ============================================
       RESPONSIVE
       ============================================ */
    @media (max-width: 900px) {
      .hero-grid { grid-template-columns: 1fr; gap: 40px; }
      .proof-card { max-width: 400px; }
      .how-grid { grid-template-columns: 1fr 1fr; }
      .news-grid { grid-template-columns: 1fr 1fr; }
    }
    @media (max-width: 640px) {
      :root { --gutter: 20px; }
      .topbar { display: none; }
      .header-badges { display: none; }
      .hero { padding: 48px 0 40px; }
      .how-grid, .news-grid, .testimonials-grid, .privacy-grid { grid-template-columns: 1fr; }
      .estimate-row { grid-template-columns: 1fr; }
      .footer-inner { flex-direction: column; gap: 24px; }
      .footer-right { text-align: left; }
      .footer-links { justify-content: flex-start; }
      section, .how, .news, .testimonials, .privacy, .cta-section { padding: 56px 0; }
    }

    /* ============================================
       ANIMATIONS
       ============================================ */
    @keyframes fadeUp {
      from { opacity: 0; transform: translateY(16px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .hero-content > * {
      animation: fadeUp 0.5s ease both;
    }
    .hero-content > *:nth-child(1) { animation-delay: 0s; }
    .hero-content > *:nth-child(2) { animation-delay: 0.08s; }
    .hero-content > *:nth-child(3) { animation-delay: 0.16s; }
    .hero-content > *:nth-child(4) { animation-delay: 0.24s; }
    .hero-content > *:nth-child(5) { animation-delay: 0.32s; }
    .proof-card { animation: fadeUp 0.5s ease 0.2s both; }

    /* ============================================
       WIZARD PAGE (full-page view)
       ============================================ */
    .wizard-page { min-height: calc(100vh - 54px); background: var(--warm-cream); align-items: flex-start; justify-content: center; padding: 60px var(--gutter); }
    .wizard-container { width: 100%; max-width: 640px; }
    .wizard-card { background: #fff; border: 1px solid var(--ink-15); border-radius: var(--radius-lg); padding: 40px; box-shadow: var(--shadow-card); }
    .wizard-footer-note { display: flex; align-items: center; justify-content: center; gap: 6px; margin-top: 16px; font-size: 0.78rem; color: var(--ink-50); }
    .wizard-footer-note .icon { width: 14px; height: 14px; color: var(--ink-30); }
    .wizard-steps { display: flex; gap: 4px; margin-bottom: 32px; }
    .wizard-step-dot { flex: 1; height: 4px; border-radius: 2px; background: var(--ink-15); transition: background 0.2s; }
    .wizard-step-dot.active { background: var(--terra); }
    .wizard-step-dot.done { background: var(--green); }
    .wizard-step-title { font-family: 'DM Serif Display', serif; font-size: 1.3rem; margin-bottom: 4px; }
    .wizard-step-sub { font-size: 0.85rem; color: var(--ink-50); margin-bottom: 28px; }
    .wizard-panel { display: none; }
    .wizard-panel.active { display: block; }
    .wiz-row { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px; }
    .wiz-row.full { grid-template-columns: 1fr; }
    .wiz-field label { display: block; font-size: 0.7rem; font-weight: 600; letter-spacing: 0.06em; text-transform: uppercase; color: var(--ink-50); margin-bottom: 6px; }
    .wiz-field select, .wiz-field input[type="number"], .wiz-field input[type="text"] { width: 100%; height: 42px; border: 1px solid var(--ink-15); border-radius: var(--radius); padding: 0 12px; font-family: 'DM Sans', sans-serif; font-size: 0.88rem; color: var(--ink); background: #fff; }
    .wiz-field select { appearance: none; cursor: pointer; background-image: url("data:image/svg+xml,%3Csvg width='10' height='6' viewBox='0 0 10 6' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 1L5 5L9 1' stroke='%2376767C' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E"); background-repeat: no-repeat; background-position: right 12px center; }
    .wiz-field select:focus, .wiz-field input:focus { outline: none; border-color: var(--blue-mid); box-shadow: 0 0 0 3px var(--blue-glow); }
    .wiz-check { display: flex; align-items: center; gap: 10px; padding: 10px 0; cursor: pointer; font-size: 0.88rem; }
    .wiz-check input[type="checkbox"] { width: 18px; height: 18px; accent-color: var(--blue); cursor: pointer; }
    .wiz-nav { display: flex; justify-content: space-between; margin-top: 28px; }
    .wiz-nav .btn { min-width: 140px; justify-content: center; }
    .btn-ghost { background: none; border: none; color: var(--ink-50); font-family: 'DM Sans', sans-serif; font-size: 0.88rem; font-weight: 600; cursor: pointer; padding: 13px 20px; border-radius: var(--radius); }
    .btn-ghost:hover { color: var(--ink); background: var(--ink-05); }
    .wiz-isee-upload { margin-top: 12px; padding: 16px; border: 2px dashed var(--ink-15); border-radius: var(--radius); text-align: center; font-size: 0.82rem; color: var(--ink-50); cursor: pointer; transition: all 0.15s; }
    .wiz-isee-upload:hover { border-color: var(--blue-mid); background: var(--blue-light); color: var(--blue); }
    .wiz-isee-upload input { display: none; }
    @media(max-width:640px) { .wiz-row { grid-template-columns: 1fr; } .wizard-card { padding: 28px 20px; } .wizard-page { padding: 32px var(--gutter); } }

    /* ============================================
       RESULTS PAGE
       ============================================ */
    .results-page { min-height: calc(100vh - 54px); padding: 60px 0; background: var(--warm-cream); }
    .results-hero { max-width: 600px; margin: 0 auto 24px; text-align: center; background: #fff; border: 1px solid var(--ink-15); border-radius: var(--radius-lg); padding: 40px 32px; position: relative; overflow: hidden; box-shadow: var(--shadow-card); }
    .results-hero::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 3px; background: linear-gradient(90deg, var(--blue), var(--terra), var(--green)); }
    .results-hero h2 { margin-bottom: 8px; }
    .saving-amount { font-family: 'JetBrains Mono', monospace; font-size: 2.8rem; font-weight: 600; color: var(--green); line-height: 1; margin: 12px 0; }
    .bonus-count { display: inline-flex; align-items: center; gap: 6px; padding: 4px 14px; background: var(--green-light); border-radius: 20px; font-size: 0.85rem; font-weight: 600; color: var(--green); margin-top: 8px; }
    .results-actions { display: flex; gap: 8px; flex-wrap: wrap; justify-content: center; margin-bottom: 20px; max-width: 800px; margin-left: auto; margin-right: auto; }
    .action-btn { display: inline-flex; align-items: center; gap: 6px; padding: 8px 14px; border: 1px solid var(--ink-15); border-radius: var(--radius); background: #fff; color: var(--ink-75); font-family: 'DM Sans', sans-serif; font-size: 0.78rem; font-weight: 500; cursor: pointer; transition: all 0.15s; }
    .action-btn:hover { border-color: var(--blue); color: var(--blue); background: var(--blue-light); }
    .action-btn .icon { width: 14px; height: 14px; }
    .results-tabs { display: flex; gap: 2px; background: var(--ink-05); border-radius: var(--radius-lg); padding: 3px; margin-bottom: 24px; overflow-x: auto; -webkit-overflow-scrolling: touch; scrollbar-width: none; max-width: 800px; margin-left: auto; margin-right: auto; }
    .results-tabs::-webkit-scrollbar { display: none; }
    .tab-btn { display: flex; align-items: center; gap: 6px; padding: 8px 16px; border: none; border-radius: var(--radius); background: transparent; color: var(--ink-50); font-family: 'DM Sans', sans-serif; font-size: 0.82rem; font-weight: 500; cursor: pointer; white-space: nowrap; transition: all 0.15s; }
    .tab-btn:hover { color: var(--ink-75); background: rgba(255,255,255,0.5); }
    .tab-btn.active { background: #fff; color: var(--blue); font-weight: 600; box-shadow: var(--shadow-subtle); }
    .tab-btn .tab-icon { width: 16px; height: 16px; }
    .tab-btn .tab-count { display: inline-flex; align-items: center; justify-content: center; min-width: 18px; height: 18px; padding: 0 5px; border-radius: 9px; font-size: 0.68rem; font-weight: 700; font-family: 'JetBrains Mono', monospace; background: var(--ink-05); color: var(--ink-50); }
    .tab-btn.active .tab-count { background: var(--blue-light); color: var(--blue); }
    .bonus-grid { display: grid; gap: 12px; max-width: 800px; margin: 0 auto; }

    /* === BONUS CARD === */
    .bonus-card { background: #fff; border: 1px solid var(--ink-15); border-radius: var(--radius-lg); overflow: hidden; transition: box-shadow 0.2s; }
    .bonus-card:hover { box-shadow: var(--shadow-card); }
    .bonus-card-header { padding: 20px 24px 16px; }
    .bonus-title-row { display: flex; align-items: center; gap: 10px; margin-bottom: 2px; }
    .bonus-title-row .compat-dot { width: 10px; height: 10px; border-radius: 50%; flex-shrink: 0; }
    .compat-dot.high { background: var(--green); }
    .compat-dot.med { background: var(--amber); }
    .compat-dot.low { background: var(--ink-30); }
    .bonus-title-row .bonus-name { flex: 1; font-family: 'DM Sans', sans-serif; font-size: 1.05rem; font-weight: 700; color: var(--ink); line-height: 1.3; }
    .bonus-title-row .compat-badge { padding: 3px 10px; border-radius: 12px; font-family: 'JetBrains Mono', monospace; font-size: 0.72rem; font-weight: 700; flex-shrink: 0; }
    .compat-badge.high { background: #E9F5ED; color: var(--green); }
    .compat-badge.med { background: #FAF4E6; color: var(--amber); }
    .compat-badge.low { background: var(--ink-05); color: var(--ink-30); }
    .badge-regionale { display: inline-block; background: #F3E8FF; color: #6B21A8; font-size: 0.62rem; font-weight: 700; padding: 2px 6px; border-radius: 3px; text-transform: uppercase; letter-spacing: 0.03em; margin-left: 6px; vertical-align: middle; }
    .badge-scaduto { display: inline-flex; align-items: center; gap: 4px; padding: 2px 8px; background: #FEE2E2; color: #DC2626; font-family: 'DM Sans', sans-serif; font-size: 0.65rem; font-weight: 700; letter-spacing: 0.06em; text-transform: uppercase; border-radius: 3px; line-height: 1; margin-left: 6px; vertical-align: middle; }
    .bonus-meta-row { display: flex; align-items: center; gap: 8px; padding-left: 20px; margin-bottom: 14px; }
    .bonus-ente { font-size: 0.78rem; color: var(--ink-30); }
    .bonus-meta-sep { width: 3px; height: 3px; border-radius: 50%; background: var(--ink-15); }
    .bonus-scadenza { font-size: 0.72rem; color: var(--terra); font-weight: 600; }
    .bonus-scadenza.active { color: var(--ink-30); }
    .bonus-importo-box { margin: 0 24px 12px 44px; background: var(--warm-cream); border-radius: var(--radius); padding: 10px 16px; display: flex; align-items: baseline; flex-wrap: wrap; gap: 8px; }
    .importo-main { font-family: 'JetBrains Mono', monospace; font-size: 1.05rem; font-weight: 700; color: var(--green); }
    .importo-label { font-size: 0.62rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.06em; color: var(--green); background: #E9F5ED; padding: 2px 6px; border-radius: 3px; margin-left: auto; }
    .importo-range { width: 100%; font-size: 0.75rem; color: var(--ink-30); }
    .bonus-desc { padding: 0 24px 0 44px; font-size: 0.85rem; color: var(--ink-50); line-height: 1.6; margin-bottom: 4px; }
    .bonus-toggle { display: flex; align-items: center; gap: 6px; width: 100%; padding: 12px 24px; background: none; border: none; border-top: 1px solid var(--ink-15); color: var(--blue); font-family: 'DM Sans', sans-serif; font-size: 0.82rem; font-weight: 600; cursor: pointer; transition: background 0.15s; }
    .bonus-toggle:hover { background: var(--blue-light); }
    .bonus-toggle .chevron { width: 14px; height: 14px; transition: transform 0.2s; }
    .bonus-toggle.open .chevron { transform: rotate(180deg); }
    .bonus-details { display: none; padding: 0 24px 0 24px; }
    .bonus-details.show { display: block; }
    .bonus-toggle + .bonus-details::before { content: ''; display: block; height: 1px; background: var(--ink-15); margin: 0 0 16px 0; }
    .detail-section { background: none; border: none; border-radius: 0; padding: 0; margin-bottom: 16px; }
    .detail-section-title { font-family: 'DM Sans', sans-serif; font-size: 0.68rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.08em; color: var(--ink-30); margin-bottom: 8px; padding: 0; }
    .req-list { list-style: none; padding: 0; margin: 0; }
    .req-item { display: flex; align-items: start; gap: 10px; padding: 3px 0; font-size: 0.85rem; color: var(--ink-75); line-height: 1.5; }
    .req-item::before { content: ''; display: block; width: 16px; height: 16px; min-width: 16px; margin-top: 2px; border-radius: 50%; background: #E9F5ED url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3E%3Cpath d='M5 8.5l2 2 4-4' stroke='%232A6B45' stroke-width='1.5' fill='none' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E") center/16px; }
    .steps-list { list-style: none; padding: 0; margin: 0; }
    .step-item { display: flex; align-items: start; gap: 10px; padding: 3px 0; font-size: 0.85rem; color: var(--ink-75); line-height: 1.5; }
    .step-num { display: flex; align-items: center; justify-content: center; width: 20px; height: 20px; min-width: 20px; border-radius: 50%; background: var(--blue); color: #fff; font-family: 'JetBrains Mono', monospace; font-size: 0.68rem; font-weight: 700; margin-top: 0; }
    .doc-list { list-style: none; padding: 0; margin: 0; }
    .doc-item { display: flex; align-items: center; gap: 10px; padding: 4px 0; font-size: 0.85rem; color: var(--ink-75); cursor: pointer; user-select: none; transition: opacity 0.15s; }
    .doc-item:hover { opacity: 0.8; }
    .doc-checkbox { width: 18px; height: 18px; min-width: 18px; border: 1.5px solid var(--ink-15); border-radius: 4px; display: flex; align-items: center; justify-content: center; transition: all 0.15s; background: #fff; }
    .doc-item.checked .doc-checkbox { background: var(--green); border-color: var(--green); }
    .doc-item.checked .doc-checkbox::after { content: ''; display: block; width: 10px; height: 10px; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 10 10'%3E%3Cpath d='M2 5l2.5 2.5L8 3' stroke='white' stroke-width='1.5' fill='none' stroke-linecap='round'/%3E%3C/svg%3E"); }
    .doc-item.checked .doc-label { text-decoration: line-through; color: var(--ink-30); }
    .faq-list { list-style: none; padding: 0; margin: 0; }
    .faq-item { border-bottom: 1px solid var(--ink-05, #F0F0F0); }
    .faq-item:last-child { border-bottom: none; }
    .faq-question { display: flex; align-items: center; justify-content: space-between; width: 100%; padding: 8px 0; background: none; border: none; font-family: 'DM Sans', sans-serif; font-size: 0.85rem; font-weight: 600; color: var(--ink-75); cursor: pointer; text-align: left; }
    .faq-question:hover { color: var(--blue); }
    .faq-question .faq-chevron { width: 12px; height: 12px; transition: transform 0.2s; flex-shrink: 0; color: var(--ink-30); }
    .faq-question.open .faq-chevron { transform: rotate(180deg); }
    .faq-answer { display: none; padding: 0 0 8px 0; font-size: 0.82rem; color: var(--ink-50); line-height: 1.6; }
    .faq-answer.show { display: block; }
    .bonus-card-footer { display: flex; align-items: center; justify-content: space-between; padding: 10px 24px; border-top: 1px solid var(--ink-05, #F0F0F0); gap: 8px; }
    .link-verified { display: flex; align-items: center; gap: 4px; font-size: 0.72rem; color: var(--green); white-space: nowrap; }
    .link-verified .icon { width: 14px; height: 14px; }
    .link-verified .date { color: var(--ink-30); }
    .link-warn-footer { display: flex; align-items: center; gap: 4px; font-size: 0.72rem; color: var(--amber); }
    .link-warn-footer .icon { width: 14px; height: 14px; }
    .btn-sito-ufficiale { display: inline-flex; align-items: center; gap: 6px; padding: 8px 16px; background: var(--blue); color: #fff; border: none; border-radius: var(--radius); font-family: 'DM Sans', sans-serif; font-size: 0.78rem; font-weight: 600; cursor: pointer; text-decoration: none; transition: background 0.15s; }
    .btn-sito-ufficiale:hover { background: var(--blue-mid); text-decoration: none; }
    .btn-sito-ufficiale .icon { width: 14px; height: 14px; }
    .bonus-verifica { margin-bottom: 10px; padding: 10px 14px; background: var(--amber-light); border-left: 3px solid var(--amber); border-radius: 0 var(--radius) var(--radius) 0; font-size: 0.78rem; color: var(--ink-75); display: flex; gap: 8px; align-items: flex-start; }
    .bonus-verifica a { color: var(--blue-mid); text-decoration: underline; }
    .results-modify { text-align: center; margin-top: 32px; }

    /* Expired bonus */
    .bonus-card--expired { opacity: 0.65; border-color: var(--ink-15); }
    .bonus-card--expired:hover { opacity: 0.8; }
    .bonus-card--expired .compat-dot { background: var(--ink-30) !important; }
    .bonus-card--expired .importo-main { color: var(--ink-30); text-decoration: line-through; }
    .bonus-card--expired .importo-label { display: none; }
    .expired-note { display: none; padding: 10px 24px; font-size: 0.78rem; color: var(--ink-30); text-align: center; font-style: italic; border-top: 1px solid var(--ink-15); background: var(--ink-05); }
    .bonus-card--expired .expired-note { display: flex; align-items: center; justify-content: center; gap: 6px; }
    .expired-separator { display: flex; align-items: center; gap: 12px; margin: 24px 0 16px; max-width: 800px; margin-left: auto; margin-right: auto; }
    .expired-separator-line { flex: 1; height: 1px; background: var(--ink-15); }
    .expired-separator-text { display: flex; align-items: center; gap: 4px; font-family: 'DM Sans', sans-serif; font-size: 0.75rem; font-weight: 600; color: var(--ink-30); text-transform: uppercase; letter-spacing: 0.05em; white-space: nowrap; }
    .expired-separator-text .icon { width: 14px; height: 14px; }
    .bonus-count-expired { display: inline-flex; align-items: center; gap: 4px; padding: 3px 10px; background: var(--ink-05); border-radius: 12px; font-size: 0.75rem; color: var(--ink-30); margin-top: 4px; }
    .tab-count--expired { background: #FEE2E2 !important; color: #DC2626 !important; }

    /* Print only elements */
    .print-only { display: none; }

    /* ============================================
       PRINT STYLESHEET
       ============================================ */
    @media print {
      * { -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; color-adjust: exact !important; }
      body { background: #fff !important; font-size: 10pt; line-height: 1.5; color: #333; }
      .site-header, .topbar, .results-actions, .results-tabs, .cookie-banner, .bonus-toggle, .btn-sito-ufficiale, .doc-checkbox, .faq-chevron, .wizard-footer-note, footer, .language-switcher, #landingPage, #wizardPage, .header { display: none !important; }
      .bonus-details { display: block !important; }
      .faq-answer { display: block !important; }
      .print-only { display: block !important; }
      .results-page, #resultsPage { display: block !important; max-width: 100% !important; padding: 0 !important; margin: 0 !important; min-height: auto !important; }
      .results-hero { border: 1.5pt solid #1B3A54 !important; border-radius: 6pt !important; padding: 16pt !important; margin-bottom: 16pt !important; page-break-after: avoid; text-align: center; max-width: 100% !important; }
      .results-hero::before { height: 2pt !important; background: #1B3A54 !important; }
      .saving-amount { font-size: 22pt !important; color: #2A6B45 !important; }
      .bonus-count { font-size: 9pt !important; }
      .bonus-grid { max-width: 100% !important; }
      .bonus-card { border: 1pt solid #ddd !important; border-radius: 4pt !important; margin-bottom: 10pt !important; page-break-inside: avoid; box-shadow: none !important; }
      .bonus-card-header { padding: 12pt 14pt 8pt !important; }
      .bonus-title-row .bonus-name { font-size: 11pt !important; }
      .compat-badge { border: 1pt solid currentColor !important; font-size: 7pt !important; padding: 1pt 6pt !important; }
      .bonus-importo-box { background: #F4F3EE !important; padding: 8pt 12pt !important; margin: 4pt 14pt 8pt 14pt !important; border-radius: 3pt !important; }
      .importo-main { font-size: 11pt !important; }
      .bonus-desc { font-size: 8.5pt !important; padding: 0 14pt 6pt !important; }
      .detail-section { background: none !important; border: none !important; padding: 0 !important; margin: 4pt 0 8pt !important; border-radius: 0 !important; }
      .detail-section-title { font-size: 7pt !important; margin-bottom: 4pt !important; }
      .req-item, .step-item, .doc-item { font-size: 8pt !important; padding: 2pt 0 !important; }
      .step-num { width: 14pt !important; height: 14pt !important; min-width: 14pt !important; font-size: 6pt !important; background: #1B3A54 !important; color: #fff !important; }
      .faq-question { font-size: 8.5pt !important; font-weight: 600; padding: 4pt 0 2pt !important; }
      .faq-answer { font-size: 8pt !important; padding: 0 0 4pt !important; }
      .bonus-card-footer { padding: 6pt 14pt !important; font-size: 7pt !important; }
      .bonus-card-footer a::after { content: " (" attr(href) ")"; font-size: 6pt; color: #999; word-break: break-all; }
      .bonus-scadenza { font-size: 7pt !important; border: 0.5pt solid #C0522E; padding: 1pt 4pt; border-radius: 2pt; }
      .bonus-card--expired { opacity: 0.5 !important; }
      .badge-scaduto { border: 1pt solid #DC2626 !important; background: #FEE2E2 !important; }
      .expired-separator { margin: 12pt 0 8pt !important; }
      .expired-note { display: flex !important; }
      .doc-item::before { content: '·'; display: inline; margin-right: 4pt; font-weight: bold; }
      .doc-checkbox { display: none !important; }
      .doc-item.checked .doc-label { text-decoration: none !important; color: inherit !important; }
      a { color: #2C5F7C !important; }
      h1, h2, h3, .results-hero { page-break-after: avoid; }
      .bonus-card, .detail-section { page-break-inside: avoid; }
      @page { margin: 15mm 12mm; size: A4; }
      @page :first { margin-top: 10mm; }
    }

    /* ============================================
       COOKIE BANNER
       ============================================ */
    .cookie-banner { position: fixed; bottom: 0; left: 0; right: 0; background: #fff; border-top: 1px solid var(--ink-15); box-shadow: 0 -4px 20px rgba(0,0,0,0.08); padding: 20px var(--gutter); z-index: 1000; }
    .cookie-inner { max-width: var(--max-w); margin: 0 auto; display: flex; align-items: center; gap: 20px; flex-wrap: wrap; }
    .cookie-text { flex: 1; min-width: 260px; font-size: 0.82rem; color: var(--ink-75); line-height: 1.55; }
    .cookie-text a { color: var(--blue-mid); text-decoration: underline; }
    .cookie-btns { display: flex; gap: 8px; flex-shrink: 0; }
    .cookie-btn { padding: 9px 20px; border-radius: var(--radius); font-family: 'DM Sans', sans-serif; font-size: 0.82rem; font-weight: 600; cursor: pointer; border: none; transition: all 0.15s; }
    .cookie-btn-accept { background: var(--blue); color: #fff; }
    .cookie-btn-accept:hover { background: var(--blue-mid); }
    .cookie-btn-reject { background: var(--ink-05); color: var(--ink-75); }
    .cookie-btn-reject:hover { background: var(--ink-15); }
    @media(max-width:640px) { .cookie-inner { flex-direction: column; text-align: center; } .cookie-btns { width: 100%; justify-content: center; } }
  </style>
</head>
<body>
<!-- Google Tag Manager (noscript) -->
{{if .GTMID}}<noscript><iframe src="https://www.googletagmanager.com/ns.html?id={{.GTMID}}" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>{{end}}

<!-- ============================================
     SVG ICON SPRITE (hidden, referenced via <use>)
     ============================================ -->
<svg xmlns="http://www.w3.org/2000/svg" style="display:none">
  <symbol id="ico-shield" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
  </symbol>
  <symbol id="ico-check-circle" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/>
  </symbol>
  <symbol id="ico-clock" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/>
  </symbol>
  <symbol id="ico-users" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/>
  </symbol>
  <symbol id="ico-edit" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
  </symbol>
  <symbol id="ico-zap" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>
  </symbol>
  <symbol id="ico-list" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <line x1="8" y1="6" x2="21" y2="6"/><line x1="8" y1="12" x2="21" y2="12"/><line x1="8" y1="18" x2="21" y2="18"/><line x1="3" y1="6" x2="3.01" y2="6"/><line x1="3" y1="12" x2="3.01" y2="12"/><line x1="3" y1="18" x2="3.01" y2="18"/>
  </symbol>
  <symbol id="ico-printer" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <polyline points="6 9 6 2 18 2 18 9"/><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/><rect x="6" y="14" width="12" height="8"/>
  </symbol>
  <symbol id="ico-calc" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <rect x="4" y="2" width="16" height="20" rx="2"/><line x1="8" y1="6" x2="16" y2="6"/><line x1="8" y1="10" x2="8" y2="10.01"/><line x1="12" y1="10" x2="12" y2="10.01"/><line x1="16" y1="10" x2="16" y2="10.01"/><line x1="8" y1="14" x2="8" y2="14.01"/><line x1="12" y1="14" x2="12" y2="14.01"/><line x1="16" y1="14" x2="16" y2="14.01"/><line x1="8" y1="18" x2="16" y2="18"/>
  </symbol>
  <symbol id="ico-arrow-right" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/>
  </symbol>
  <symbol id="ico-database-off" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <ellipse cx="12" cy="5" rx="9" ry="3"/><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"/><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"/><line x1="2" y1="2" x2="22" y2="22"/>
  </symbol>
  <symbol id="ico-eye-off" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/><line x1="1" y1="1" x2="23" y2="23"/>
  </symbol>
  <symbol id="ico-code" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <polyline points="16 18 22 12 16 6"/><polyline points="8 6 2 12 8 18"/>
  </symbol>
  <symbol id="ico-star" viewBox="0 0 24 24" fill="currentColor" stroke="none">
    <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
  </symbol>
  <symbol id="ico-user" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/>
  </symbol>
  <symbol id="ico-external" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/>
  </symbol>
  <symbol id="ico-github" viewBox="0 0 24 24" fill="currentColor">
    <path d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0 0 24 12c0-6.63-5.37-12-12-12z"/>
  </symbol>
  <symbol id="ico-alert" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/>
  </symbol>
  <symbol id="ico-file-text" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/>
  </symbol>
  <symbol id="ico-chevron-down" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <polyline points="6 9 12 15 18 9"/>
  </symbol>
  <symbol id="ico-home" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/>
  </symbol>
  <symbol id="ico-wallet" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <rect x="1" y="6" width="22" height="16" rx="2"/><path d="M1 10h22"/><path d="M1 6l5-4h12l5 4"/>
  </symbol>
</svg>

<!-- TOPBAR -->
<div class="topbar">
  <span data-i18n="topbar.free">Servizio gratuito</span> <span>·</span> <span data-i18n="topbar.nodata">Nessun dato salvato</span> <span>·</span> <span id="lastUpdate" data-i18n="topbar.updated">Dati aggiornati al ...</span>
</div>

<!-- HEADER -->
<header class="header">
  <div class="container header-inner">
    <div class="header-left">
      <a href="/" class="logo">
        <div class="logo-mark">B</div>
        <span class="logo-text">BonusPerMe</span>
      </a>
      <div class="header-badges">
                <span class="header-badge">
                    <span class="icon"><svg><use href="#ico-shield"/></svg></span> GDPR
                </span>
        <span class="header-badge">
                    <span class="icon"><svg><use href="#ico-eye-off"/></svg></span> Privacy First
                </span>
      </div>
    </div>
    <div class="header-right">
      <!-- Language Dropdown -->
      <div class="lang-dropdown-wrap" id="langWrap">
        <button class="lang-trigger" onclick="toggleLangDropdown()" aria-haspopup="true" aria-expanded="false" id="langTrigger">
          <span class="flag flag-it" id="langFlag"></span>
          <span id="langLabel">IT</span>
          <svg class="chevron" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"/></svg>
        </button>
        <div class="lang-dropdown" id="langDropdown" role="listbox">
          <button class="lang-option active" data-lang="it" onclick="selectLang('it')" role="option">
            <span class="flag flag-it"></span> Italiano
            <svg class="check" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="20 6 9 17 4 12"/></svg>
          </button>
          <button class="lang-option" data-lang="en" onclick="selectLang('en')" role="option">
            <span class="flag flag-en"></span> English
            <svg class="check" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="20 6 9 17 4 12"/></svg>
          </button>
          <button class="lang-option" data-lang="fr" onclick="selectLang('fr')" role="option">
            <span class="flag flag-fr"></span> Français
            <svg class="check" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="20 6 9 17 4 12"/></svg>
          </button>
          <button class="lang-option" data-lang="es" onclick="selectLang('es')" role="option">
            <span class="flag flag-es"></span> Español
            <svg class="check" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="20 6 9 17 4 12"/></svg>
          </button>
          <button class="lang-option" data-lang="ro" onclick="selectLang('ro')" role="option">
            <span class="flag flag-ro"></span> Română
            <svg class="check" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="20 6 9 17 4 12"/></svg>
          </button>
          <button class="lang-option" data-lang="ar" onclick="selectLang('ar')" role="option">
            <span class="flag flag-ar"></span> العربية
            <svg class="check" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="20 6 9 17 4 12"/></svg>
          </button>
          <button class="lang-option" data-lang="sq" onclick="selectLang('sq')" role="option">
            <span class="flag flag-sq"></span> Shqip
            <svg class="check" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="20 6 9 17 4 12"/></svg>
          </button>
        </div>
      </div>
    </div>
  </div>
</header>

<!-- COOKIE BANNER -->
<div id="cookieBanner" class="cookie-banner" style="display:none">
  <div class="cookie-inner">
    <div class="cookie-text">
      Utilizziamo cookie tecnici e, con il tuo consenso, cookie analitici (Google Analytics) per migliorare il servizio.
      <a href="/cookie-policy">Cookie Policy</a> · <a href="/privacy">Privacy Policy</a>
    </div>
    <div class="cookie-btns">
      <button class="cookie-btn cookie-btn-accept" onclick="acceptCookies()">Accetta</button>
      <button class="cookie-btn cookie-btn-reject" onclick="rejectCookies()">Rifiuta</button>
    </div>
  </div>
</div>

<!-- LANDING PAGE -->
<div id="landingPage">

<!-- HERO -->
<section class="hero">
  <div class="container hero-grid">
    <div class="hero-content">
      <div class="label hero-pretitle">
        <span class="icon icon-sm"><svg><use href="#ico-check-circle"/></svg></span>
        <span data-i18n="hero.pretitle">Verifica gratuita</span>
      </div>
      <h1 data-i18n="hero.title">Scopri in 2 minuti a quali bonus hai diritto</h1>
      <p class="hero-subtitle" data-i18n="hero.subtitle">
        Confrontiamo la tua situazione con oltre 40 bonus statali e regionali attivi in Italia.
        Gratis, anonimo, senza registrazione.
      </p>
      <div class="hero-cta-row">
        <button class="btn btn-primary" onclick="startWizard()">
          <span data-i18n="hero.cta">Inizia la verifica</span>
          <span class="icon icon-sm"><svg><use href="#ico-arrow-right"/></svg></span>
        </button>
      </div>
      <div class="hero-meta">
                <span class="hero-meta-item">
                    <span class="icon"><svg><use href="#ico-clock"/></svg></span> 2 minuti
                </span>
        <span class="hero-meta-item">
                    <span class="icon"><svg><use href="#ico-edit"/></svg></span> 4 domande
                </span>
        <span class="hero-meta-item">
                    <span class="icon"><svg><use href="#ico-shield"/></svg></span> Nessuna registrazione
                </span>
      </div>
    </div>

    <div class="proof-card">
      <div class="proof-number" id="proofCounter">14.335</div>
      <div class="proof-label" data-i18n="hero.counter_label">famiglie aiutate</div>
      <hr class="proof-divider">
      <p class="proof-quote">
        Secondo i dati INPS, ogni anno restano non richiesti
        circa 2,1 miliardi di euro in bonus familiari.
      </p>
      <p class="proof-source">
        <span class="icon"><svg><use href="#ico-file-text"/></svg></span>
        Fonte: Osservatorio INPS sull'Assegno Unico, 2025
      </p>
    </div>
  </div>
</section>

<!-- QUICK ESTIMATE -->
<section class="estimate">
  <div class="container estimate-inner">
    <div class="estimate-title">
      <span class="icon icon-lg"><svg><use href="#ico-calc"/></svg></span>
      <h3>Stima veloce</h3>
    </div>
    <p class="estimate-sub">Quanto potresti ricevere ogni anno?</p>
    <div class="estimate-row">
      <div class="estimate-field">
        <label>
          <span class="icon"><svg><use href="#ico-users"/></svg></span>
          Numero figli
        </label>
        <select id="est-figli">
          <option value="0">Nessun figlio</option>
          <option value="1">1 figlio</option>
          <option value="2" selected>2 figli</option>
          <option value="3">3 figli</option>
          <option value="4">4+ figli</option>
        </select>
      </div>
      <div class="estimate-field">
        <label>
          <span class="icon"><svg><use href="#ico-wallet"/></svg></span>
          Fascia ISEE
        </label>
        <select id="est-isee">
          <option value="sotto15k" selected>Sotto €15.000</option>
          <option value="15-25k">€15.000 — €25.000</option>
          <option value="25-40k">€25.000 — €40.000</option>
          <option value="sopra40k">Sopra €40.000</option>
          <option value="noisee">Non ho l'ISEE</option>
        </select>
      </div>
    </div>
    <div class="estimate-result">
      <span class="icon"><svg><use href="#ico-check-circle"/></svg></span>
      <div class="estimate-amount" id="est-result">Fino a €8.400/anno</div>
    </div>
    <p class="estimate-note">Stima indicativa basata su dati medi nazionali · Verifica con i tuoi dati reali</p>
  </div>
</section>

<!-- HOW IT WORKS -->
<section class="how">
  <div class="container">
    <div class="section-header">
      <h2 data-i18n="how.title">Come funziona</h2>
      <p data-i18n="how.subtitle">Dalla verifica al CAF in 4 passaggi.</p>
    </div>
    <div class="how-grid">
      <div class="how-card">
        <div class="how-icon-row">
          <div class="how-card-icon step-1"><span class="icon"><svg><use href="#ico-edit"/></svg></span></div>
          <span class="how-num">01</span>
        </div>
        <h3 data-i18n="how.step1.title">Inserisci i dati</h3>
        <p data-i18n="how.step1.desc">Età, famiglia, ISEE e situazione abitativa. Solo l'essenziale, niente di più.</p>
      </div>
      <div class="how-card">
        <div class="how-icon-row">
          <div class="how-card-icon step-2"><span class="icon"><svg><use href="#ico-zap"/></svg></span></div>
          <span class="how-num">02</span>
        </div>
        <h3 data-i18n="how.step2.title">Analisi istantanea</h3>
        <p data-i18n="how.step2.desc">Confrontiamo la tua situazione con tutti i bonus attivi, nazionali e regionali.</p>
      </div>
      <div class="how-card">
        <div class="how-icon-row">
          <div class="how-card-icon step-3"><span class="icon"><svg><use href="#ico-list"/></svg></span></div>
          <span class="how-num">03</span>
        </div>
        <h3 data-i18n="how.step3.title">Risultati chiari</h3>
        <p data-i18n="how.step3.desc">Lista personalizzata con importi, requisiti e istruzioni passo per passo.</p>
      </div>
      <div class="how-card">
        <div class="how-icon-row">
          <div class="how-card-icon step-4"><span class="icon"><svg><use href="#ico-printer"/></svg></span></div>
          <span class="how-num">04</span>
        </div>
        <h3 data-i18n="how.step4.title">Porta al CAF</h3>
        <p data-i18n="how.step4.desc">Stampa il report con documenti e fonti ufficiali. Il patronato fa il resto.</p>
      </div>
    </div>
  </div>
</section>

<!-- NEWS -->
<section class="news">
  <div class="container">
    <div class="section-header">
      <h2>Novità 2025</h2>
      <p>Le misure nuove o modificate dalla Legge di Bilancio.</p>
    </div>
    <div class="news-grid">
      <div class="news-card">
                <span class="news-badge nuovo">
                    <span class="icon"><svg><use href="#ico-zap"/></svg></span> Nuovo
                </span>
        <h3>Carta Nuovi Nati</h3>
        <p>€1.000 per ogni figlio nato dal 2025. ISEE fino a €40.000. Novità dalla Legge di Bilancio.</p>
      </div>
      <div class="news-card">
                <span class="news-badge modificato">
                    <span class="icon"><svg><use href="#ico-alert"/></svg></span> Modificato
                </span>
        <h3>Ristrutturazione al 36%</h3>
        <p>Per le seconde case, la detrazione scende dal 50% al 36%. Prima casa resta al 50%.</p>
      </div>
      <div class="news-card">
                <span class="news-badge modificato">
                    <span class="icon"><svg><use href="#ico-alert"/></svg></span> Modificato
                </span>
        <h3>Assegno Unico rivalutato</h3>
        <p>Importi adeguati all'inflazione ISTAT. Maggiorazioni confermate per famiglie numerose.</p>
      </div>
      <div class="news-card">
                <span class="news-badge nuovo">
                    <span class="icon"><svg><use href="#ico-zap"/></svg></span> Nuovo
                </span>
        <h3>Bonus Psicologo confermato</h3>
        <p>Rifinanziato per il 2025. Fino a €1.500 per percorsi di psicoterapia.</p>
      </div>
      <div class="news-card">
                <span class="news-badge modificato">
                    <span class="icon"><svg><use href="#ico-alert"/></svg></span> Modificato
                </span>
        <h3>Superbonus al 65%</h3>
        <p>Solo per lavori già avviati su condomini. Fine sconto in fattura per nuove pratiche.</p>
      </div>
      <div class="news-card">
                <span class="news-badge nuovo">
                    <span class="icon"><svg><use href="#ico-zap"/></svg></span> Nuovo
                </span>
        <h3>Bonus Elettrodomestici</h3>
        <p>Contributo per sostituzione in classe A. Fino a €200 con ISEE sotto €25.000.</p>
      </div>
    </div>
  </div>
</section>

<!-- TESTIMONIALS -->
<section class="testimonials">
  <div class="container">
    <div class="section-header">
      <h2 data-i18n="testimonials.title">Cosa dicono le famiglie</h2>
    </div>
    <div class="testimonials-grid">
      <div class="test-card">
        <div class="test-stars">
          <span class="icon"><svg><use href="#ico-star"/></svg></span>
          <span class="icon"><svg><use href="#ico-star"/></svg></span>
          <span class="icon"><svg><use href="#ico-star"/></svg></span>
          <span class="icon"><svg><use href="#ico-star"/></svg></span>
          <span class="icon"><svg><use href="#ico-star"/></svg></span>
        </div>
        <p class="test-quote">Non sapevamo di avere diritto all'Assegno Unico con quell'importo. Abbiamo scoperto 4 bonus e risparmiamo oltre 3.200 euro l'anno.</p>
        <hr class="test-divider">
        <div class="test-author">
          <div class="test-avatar"><span class="icon"><svg><use href="#ico-user"/></svg></span></div>
          <div>
            <div class="test-name">Maria R.</div>
            <div class="test-info">Roma · famiglia con 2 figli</div>
          </div>
        </div>
      </div>
      <div class="test-card">
        <div class="test-stars">
          <span class="icon"><svg><use href="#ico-star"/></svg></span>
          <span class="icon"><svg><use href="#ico-star"/></svg></span>
          <span class="icon"><svg><use href="#ico-star"/></svg></span>
          <span class="icon"><svg><use href="#ico-star"/></svg></span>
          <span class="icon"><svg><use href="#ico-star"/></svg></span>
        </div>
        <p class="test-quote">Ho caricato l'ISEE, risposto a 4 domande, e in 2 minuti avevo tutto chiaro. Ho stampato il report e l'ho portato al CAF.</p>
        <hr class="test-divider">
        <div class="test-author">
          <div class="test-avatar"><span class="icon"><svg><use href="#ico-user"/></svg></span></div>
          <div>
            <div class="test-name">Ahmed K.</div>
            <div class="test-info">Milano · lavoratore dipendente</div>
          </div>
        </div>
      </div>
      <div class="test-card">
        <div class="test-stars">
          <span class="icon"><svg><use href="#ico-star"/></svg></span>
          <span class="icon"><svg><use href="#ico-star"/></svg></span>
          <span class="icon"><svg><use href="#ico-star"/></svg></span>
          <span class="icon"><svg><use href="#ico-star"/></svg></span>
          <span class="icon"><svg><use href="#ico-star"/></svg></span>
        </div>
        <p class="test-quote">Il mio CAF non mi aveva parlato del Bonus Psicologo. Qui l'ho trovato subito con tutti i documenti necessari.</p>
        <hr class="test-divider">
        <div class="test-author">
          <div class="test-avatar"><span class="icon"><svg><use href="#ico-user"/></svg></span></div>
          <div>
            <div class="test-name">Giulia T.</div>
            <div class="test-info">Napoli · studentessa</div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- PRIVACY -->
<section class="privacy">
  <div class="container">
    <h2 data-i18n="privacy.title">I tuoi dati restano tuoi</h2>
    <div class="privacy-grid">
      <div class="privacy-item">
        <div class="privacy-icon"><span class="icon"><svg><use href="#ico-database-off"/></svg></span></div>
        <h4 data-i18n="privacy.db_title">Nessun database</h4>
        <p data-i18n="privacy.db_desc">I dati esistono solo nella tua sessione browser. Al refresh della pagina, spariscono. Non salviamo nulla.</p>
      </div>
      <div class="privacy-item">
        <div class="privacy-icon"><span class="icon"><svg><use href="#ico-eye-off"/></svg></span></div>
        <h4 data-i18n="privacy.track_title">Privacy first</h4>
        <p data-i18n="privacy.track_desc">Usiamo solo Google Analytics anonimo, e solo con il tuo consenso. Nessun cookie di profilazione.</p>
      </div>
      <div class="privacy-item">
        <div class="privacy-icon"><span class="icon"><svg><use href="#ico-code"/></svg></span></div>
        <h4 data-i18n="privacy.code_title">Codice aperto</h4>
        <p data-i18n="privacy.code_desc">Il sorgente è su GitHub sotto licenza AGPL-3.0. Chiunque può verificare cosa fa il codice.</p>
      </div>
    </div>
  </div>
</section>

<!-- CTA FINALE -->
<section class="cta-section">
  <div class="container">
    <h2 data-i18n="cta.title">Scopri quanto potresti risparmiare</h2>
    <p data-i18n="cta.subtitle">In 2 minuti sai esattamente a quali bonus hai diritto e come fare domanda.</p>
    <button class="btn btn-primary" onclick="startWizard()">
      <span data-i18n="hero.cta">Inizia la verifica gratuita</span>
      <span class="icon icon-sm"><svg><use href="#ico-arrow-right"/></svg></span>
    </button>
  </div>
</section>

<!-- FOOTER -->
<footer class="footer">
  <div class="container footer-inner">
    <div class="footer-left">
      <a href="/" class="logo">
        <div class="logo-mark">B</div>
        <span class="logo-text">BonusPerMe</span>
      </a>
      <p data-i18n="footer.disclaimer">Progetto gratuito e open source. Non siamo un CAF né un patronato. Le informazioni sono a scopo orientativo.</p>
    </div>
    <div class="footer-right">
      <div class="footer-links">
        <a href="https://github.com/nicospa/bonusperme">
          <span class="icon"><svg><use href="#ico-github"/></svg></span> GitHub
        </a>
        <a href="/privacy">
          <span class="icon"><svg><use href="#ico-shield"/></svg></span> Privacy Policy
        </a>
        <a href="/cookie-policy">
          <span class="icon"><svg><use href="#ico-file-text"/></svg></span> Cookie Policy
        </a>
        <a href="/per-caf">
          <span class="icon"><svg><use href="#ico-home"/></svg></span> Per i CAF
        </a>
        <a href="/contatti">
          <span class="icon"><svg><use href="#ico-edit"/></svg></span> Contatti
        </a>
      </div>
      <div class="footer-badges">
        Simone Nogara · P.IVA 03817020138 <span>·</span> info@bonusperme.it
      </div>
      <div class="footer-badges" style="margin-top:4px">
        GDPR <span>·</span> Privacy First <span>·</span> Server EU <span>·</span> Open Source
      </div>
    </div>
  </div>
</footer>

</div><!-- /landingPage -->

<!-- WIZARD PAGE -->
<div id="wizardPage" class="wizard-page" style="display:none">
  <div class="wizard-container">
    <div class="wizard-card">
      <div class="wizard-steps">
        <div class="wizard-step-dot active" data-step="0"></div>
        <div class="wizard-step-dot" data-step="1"></div>
        <div class="wizard-step-dot" data-step="2"></div>
        <div class="wizard-step-dot" data-step="3"></div>
      </div>

      <!-- Step 1: Personal -->
      <div class="wizard-panel active" data-panel="0">
        <h2 class="wizard-step-title" data-i18n="step1.title">Dati personali</h2>
        <p class="wizard-step-sub" data-i18n="step1.subtitle">Informazioni di base per la verifica.</p>
        <div class="wiz-row">
        {{if .TurnstileSiteKey}}<div class="cf-turnstile" data-sitekey="{{.TurnstileSiteKey}}" data-callback="onTurnstileSuccess" data-theme="light" style="margin-bottom:16px"></div>{{end}}
          <div class="wiz-field">
            <label for="wiz-eta" data-i18n="label.eta">Età</label>
            <input type="number" id="wiz-eta" min="18" max="120" value="35" placeholder="Es. 35">
          </div>
          <div class="wiz-field">
            <label for="wiz-stato-civile" data-i18n="label.stato_civile">Stato civile</label>
            <select id="wiz-stato-civile">
              <option value="" data-i18n="opt.select">— Seleziona —</option>
              <option value="celibe/nubile" data-i18n="opt.single">Celibe / Nubile</option>
              <option value="coniugato/a" data-i18n="opt.married">Coniugato/a</option>
              <option value="convivente" data-i18n="opt.cohabiting">Convivente</option>
              <option value="separato/a" data-i18n="opt.separated">Separato/a</option>
              <option value="divorziato/a" data-i18n="opt.separated">Divorziato/a</option>
              <option value="vedovo/a" data-i18n="opt.widowed">Vedovo/a</option>
            </select>
          </div>
        </div>
        <div class="wiz-row">
          <div class="wiz-field">
            <label for="wiz-occupazione" data-i18n="label.occupazione">Occupazione</label>
            <select id="wiz-occupazione">
              <option value="" data-i18n="opt.select">— Seleziona —</option>
              <option value="dipendente" data-i18n="opt.employee">Dipendente</option>
              <option value="autonomo" data-i18n="opt.selfemployed">Autonomo</option>
              <option value="pensionato" data-i18n="opt.retired">Pensionato</option>
              <option value="disoccupato" data-i18n="opt.unemployed">Disoccupato</option>
              <option value="casalinga" data-i18n="opt.inactive">Casalinga</option>
              <option value="studente" data-i18n="opt.student">Studente</option>
            </select>
          </div>
          <div class="wiz-field" style="display:flex;align-items:flex-end">
            <label class="wiz-check">
              <input type="checkbox" id="wiz-studente"> <span data-i18n="label.studente">Studente universitario</span>
            </label>
          </div>
        </div>
        <div class="wiz-nav">
          <button class="btn-ghost" onclick="backToLanding()" data-i18n="btn.prev">Indietro</button>
          <button class="btn btn-primary" onclick="wizNext()">
            <span data-i18n="btn.next">Avanti</span>
            <span class="icon icon-sm"><svg><use href="#ico-arrow-right"/></svg></span>
          </button>
        </div>
      </div>

      <!-- Step 2: Family -->
      <div class="wizard-panel" data-panel="1">
        <h2 class="wizard-step-title" data-i18n="step2.title">Nucleo familiare</h2>
        <p class="wizard-step-sub" data-i18n="step2.subtitle">Composizione della tua famiglia.</p>
        <div class="wiz-row">
          <div class="wiz-field">
            <label for="wiz-figli" data-i18n="label.numero_figli">Numero figli</label>
            <input type="number" id="wiz-figli" min="0" max="20" value="0">
          </div>
          <div class="wiz-field">
            <label for="wiz-figli-min" data-i18n="label.figli_minorenni">Figli minorenni</label>
            <input type="number" id="wiz-figli-min" min="0" max="20" value="0">
          </div>
        </div>
        <div class="wiz-row">
          <div class="wiz-field">
            <label for="wiz-figli-u3" data-i18n="label.figli_under3">Figli under 3 anni</label>
            <input type="number" id="wiz-figli-u3" min="0" max="20" value="0">
          </div>
          <div class="wiz-field">
            <label for="wiz-over65" data-i18n="label.over65">Over 65 nel nucleo</label>
            <input type="number" id="wiz-over65" min="0" max="10" value="0">
          </div>
        </div>
        <label class="wiz-check">
          <input type="checkbox" id="wiz-disabilita"> <span data-i18n="label.disabilita">Componente con disabilità nel nucleo</span>
        </label>
        <label class="wiz-check">
          <input type="checkbox" id="wiz-nuovo-nato"> <span data-i18n="label.nuovo_nato">Nuovo nato nel 2025</span>
        </label>
        <div class="wiz-nav">
          <button class="btn-ghost" onclick="wizPrev()" data-i18n="btn.prev">Indietro</button>
          <button class="btn btn-primary" onclick="wizNext()">
            <span data-i18n="btn.next">Avanti</span>
            <span class="icon icon-sm"><svg><use href="#ico-arrow-right"/></svg></span>
          </button>
        </div>
      </div>

      <!-- Step 3: Housing -->
      <div class="wizard-panel" data-panel="2">
        <h2 class="wizard-step-title" data-i18n="step4.title">Situazione abitativa</h2>
        <p class="wizard-step-sub" data-i18n="step4.subtitle">Residenza e condizione casa.</p>
        <div class="wiz-row full">
          <div class="wiz-field">
            <label for="wiz-residenza" data-i18n="label.regione">Regione di residenza</label>
            <select id="wiz-residenza">
              <option value="">— Seleziona regione —</option>
              <option value="Piemonte">Piemonte</option>
              <option value="Valle d'Aosta">Valle d'Aosta</option>
              <option value="Lombardia">Lombardia</option>
              <option value="Trentino-Alto Adige">Trentino-Alto Adige</option>
              <option value="Veneto">Veneto</option>
              <option value="Friuli Venezia Giulia">Friuli Venezia Giulia</option>
              <option value="Liguria">Liguria</option>
              <option value="Emilia-Romagna">Emilia-Romagna</option>
              <option value="Toscana">Toscana</option>
              <option value="Umbria">Umbria</option>
              <option value="Marche">Marche</option>
              <option value="Lazio">Lazio</option>
              <option value="Abruzzo">Abruzzo</option>
              <option value="Molise">Molise</option>
              <option value="Campania">Campania</option>
              <option value="Puglia">Puglia</option>
              <option value="Basilicata">Basilicata</option>
              <option value="Calabria">Calabria</option>
              <option value="Sicilia">Sicilia</option>
              <option value="Sardegna">Sardegna</option>
            </select>
          </div>
        </div>
        <label class="wiz-check">
          <input type="checkbox" id="wiz-affittuario"> <span data-i18n="label.affittuario">Sono in affitto</span>
        </label>
        <label class="wiz-check">
          <input type="checkbox" id="wiz-prima-abitazione"> <span data-i18n="label.prima_casa">Prima abitazione di proprietà</span>
        </label>
        <label class="wiz-check">
          <input type="checkbox" id="wiz-ristrutturazione"> <span data-i18n="label.ristrutturazione">Ristrutturazione casa in corso / prevista</span>
        </label>
        <div class="wiz-nav">
          <button class="btn-ghost" onclick="wizPrev()" data-i18n="btn.prev">Indietro</button>
          <button class="btn btn-primary" onclick="wizNext()">
            <span data-i18n="btn.next">Avanti</span>
            <span class="icon icon-sm"><svg><use href="#ico-arrow-right"/></svg></span>
          </button>
        </div>
      </div>

      <!-- Step 4: Income -->
      <div class="wizard-panel" data-panel="3">
        <h2 class="wizard-step-title" data-i18n="step3.title">Situazione economica</h2>
        <p class="wizard-step-sub" data-i18n="step3.subtitle">ISEE e reddito. Se non hai l'ISEE lascia 0.</p>
        <div class="wiz-row">
          <div class="wiz-field">
            <label for="wiz-isee" data-i18n="label.isee">ISEE annuo (EUR)</label>
            <input type="number" id="wiz-isee" min="0" max="500000" value="0" step="100" placeholder="Es. 15000">
          </div>
          <div class="wiz-field">
            <label for="wiz-reddito" data-i18n="label.reddito">Reddito annuo (EUR)</label>
            <input type="number" id="wiz-reddito" min="0" max="1000000" value="0" step="100" placeholder="Es. 25000">
          </div>
        </div>
        <div class="wiz-isee-upload" id="iseeUploadZone">
          <input type="file" id="iseeFile" accept=".pdf">
          <span class="icon icon-sm"><svg><use href="#ico-file-text"/></svg></span>
          <span data-i18n="isee.upload">Hai il PDF dell'ISEE? Trascinalo qui o clicca per caricarlo</span>
          <div id="iseeUploadStatus" style="margin-top:8px;font-weight:600;display:none"></div>
        </div>
        <div class="wiz-nav">
          <button class="btn-ghost" onclick="wizPrev()" data-i18n="btn.prev">Indietro</button>
          <button class="btn btn-primary" onclick="wizSubmit()" id="wizSubmitBtn">
            <span class="icon icon-sm"><svg><use href="#ico-zap"/></svg></span>
            <span data-i18n="btn.submit">Verifica bonus</span>
          </button>
        </div>
      </div>
    </div>
    <p class="wizard-footer-note">
      <span class="icon"><svg><use href="#ico-shield"/></svg></span>
      I tuoi dati non vengono salvati
    </p>
  </div>
</div><!-- /wizardPage -->

<!-- RESULTS PAGE -->
<div id="resultsPage" class="results-page" style="display:none">
  <div class="container">
    <!-- Print header (hidden on screen, visible in print) -->
    <div class="print-only" style="display:none;padding:0 0 12pt 0;border-bottom:2pt solid #1B3A54;margin-bottom:16pt;">
      <div style="display:flex;align-items:center;justify-content:space-between;">
        <div>
          <div style="font-family:'DM Serif Display',serif;font-size:16pt;font-weight:700;color:#1B3A54;">BonusPerMe</div>
          <div style="font-size:8pt;color:#666;">Report Personalizzato</div>
        </div>
        <div style="font-size:8pt;color:#999;text-align:right;">
          Generato il <span id="printDate"></span><br>
          bonusperme.it &middot; Documento a scopo orientativo
        </div>
      </div>
    </div>

    <div class="results-hero" id="resultsHero">
      <h2 id="results-title" data-i18n="results.title">I tuoi bonus</h2>
      <div class="saving-amount" id="results-saving"></div>
      <div class="bonus-count" id="results-count"></div>
    </div>
    <div class="results-actions">
      <button class="action-btn" onclick="downloadReport('print')">
        <span class="icon"><svg><use href="#ico-printer"/></svg></span> <span data-i18n="results.print">Stampa</span>
      </button>
      <button class="action-btn" onclick="downloadReport('download')">
        <span class="icon"><svg><use href="#ico-file-text"/></svg></span> <span data-i18n="results.pdf">PDF</span>
      </button>
      <button class="action-btn" onclick="exportCalendar()">
        <span class="icon"><svg><use href="#ico-clock"/></svg></span> <span data-i18n="results.calendar">Scadenze</span>
      </button>
      <button class="action-btn" onclick="shareWhatsApp()">
        <span class="icon"><svg><use href="#ico-external"/></svg></span> <span data-i18n="results.share">Condividi</span>
      </button>
    </div>
    <div class="results-tabs" id="resultsTabs"></div>
    <div class="bonus-grid" id="bonusGrid"></div>
    <div class="results-modify">
      <button class="btn btn-outline" onclick="backToWizard()">
        <span class="icon icon-sm"><svg><use href="#ico-edit"/></svg></span>
        <span data-i18n="btn.modify">Modifica dati</span>
      </button>
    </div>

    <!-- Print footer (hidden on screen, visible in print) -->
    <div class="print-only" style="display:none;margin-top:20pt;padding-top:10pt;border-top:1pt solid #ddd;font-size:7pt;color:#999;text-align:center;">
      BonusPerMe &middot; bonusperme.it &middot; info@bonusperme.it<br>
      Simone Nogara &middot; P.IVA 03817020138 &middot; Via Morazzone 4, 22100 Como (CO)<br>
      Questo documento a scopo orientativo e non sostituisce la consulenza professionale.
    </div>
  </div>
</div><!-- /resultsPage -->

<script>
  /* Language dropdown */
  function toggleLangDropdown() {
    var wrap = document.getElementById('langWrap');
    var isOpen = wrap.classList.toggle('open');
    document.getElementById('langTrigger').setAttribute('aria-expanded', isOpen);
    if (isOpen) {
      setTimeout(function() {
        document.addEventListener('click', closeLangOutside, true);
      }, 0);
    }
  }
  function closeLangOutside(e) {
    var wrap = document.getElementById('langWrap');
    if (!wrap.contains(e.target)) {
      wrap.classList.remove('open');
      document.getElementById('langTrigger').setAttribute('aria-expanded', 'false');
      document.removeEventListener('click', closeLangOutside, true);
    }
  }
  var currentLang = 'it';

  function selectLang(lang) {
    document.querySelectorAll('.lang-option').forEach(function(o) {
      o.classList.toggle('active', o.dataset.lang === lang);
    });
    var selected = document.querySelector('.lang-option[data-lang="'+lang+'"]');
    if (selected) {
      document.getElementById('langLabel').textContent = lang.toUpperCase();
      var flagClasses = document.getElementById('langFlag').className.split(' ').filter(function(c) { return c === 'flag'; });
      document.getElementById('langFlag').className = flagClasses.join(' ') + ' flag-' + lang;
    }
    document.getElementById('langWrap').classList.remove('open');
    document.getElementById('langTrigger').setAttribute('aria-expanded', 'false');
    document.removeEventListener('click', closeLangOutside, true);

    currentLang = lang;
    fetch('/api/translations?lang=' + lang)
      .then(function(r) { return r.json(); })
      .then(function(t) { applyTranslations(t); });
  }

  var currentTranslations = {};

  function applyTranslations(t) {
    currentTranslations = t;
    document.querySelectorAll('[data-i18n]').forEach(function(el) {
      var key = el.dataset.i18n;
      if (!t[key]) return;
      if (el.tagName === 'OPTION') {
        el.textContent = t[key];
      } else {
        // Preserve child SVG icons in buttons
        var svg = el.querySelector('svg, .icon');
        if (svg && el.children.length > 0) {
          // Only update text nodes
          Array.from(el.childNodes).forEach(function(n) {
            if (n.nodeType === 3 && n.textContent.trim()) n.textContent = ' ' + t[key] + ' ';
          });
          // If no text node found, try span
          var span = el.querySelector('span[data-i18n]');
          if (!span) el.textContent = t[key];
        } else {
          el.textContent = t[key];
        }
      }
    });
    // If results visible, re-render bonus cards
    if (lastResult && document.getElementById('resultsPage').style.display !== 'none') {
      renderBonusCards(lastResult.bonus, activeFilter);
    }
  }

  /* Quick estimate calculator */
  function updateEstimate() {
    var figli = parseInt(document.getElementById('est-figli').value);
    var fascia = document.getElementById('est-isee').value;
    var total = 0;
    if (figli > 0) {
      var rates = { 'sotto15k': 200, '15-25k': 150, '25-40k': 100, 'sopra40k': 57, 'noisee': 57 };
      total += figli * (rates[fascia] || 57) * 12;
    }
    if (figli > 0 && (fascia === 'sotto15k' || fascia === '15-25k')) {
      var nido = { 'sotto15k': 3600, '15-25k': 2500 };
      total += nido[fascia] || 0;
    }
    if (fascia === 'sotto15k') total += 500;
    var formatted = total > 0
            ? 'Fino a €' + total.toLocaleString('it-IT') + '/anno'
            : 'Inserisci i dati per la stima';
    document.getElementById('est-result').textContent = formatted;
  }
  document.getElementById('est-figli').addEventListener('change', updateEstimate);
  document.getElementById('est-isee').addEventListener('change', updateEstimate);
  updateEstimate();

  /* Load last scraping date */
  function updateLastScrapeDate() {
    fetch('/api/status')
      .then(function(r) { return r.json(); })
      .then(function(data) {
        if (data.last_update_display) {
          var el = document.getElementById('lastUpdate');
          if (el) el.textContent = 'Dati aggiornati al ' + data.last_update_display;
        }
      })
      .catch(function() {
        var now = new Date();
        var dd = String(now.getDate()).padStart(2, '0');
        var mm = String(now.getMonth() + 1).padStart(2, '0');
        var yyyy = now.getFullYear();
        var hh = String(now.getHours()).padStart(2, '0');
        var min = String(now.getMinutes()).padStart(2, '0');
        var el = document.getElementById('lastUpdate');
        if (el) el.textContent = 'Dati aggiornati al ' + dd + '/' + mm + '/' + yyyy + ' alle ' + hh + ':' + min;
      });
  }
  updateLastScrapeDate();

  /* ============================================
     PAGE NAVIGATION
     ============================================ */
  window.dataLayer = window.dataLayer || [];

  function startWizard() {
    document.getElementById('landingPage').style.display = 'none';
    document.getElementById('wizardPage').style.display = 'flex';
    document.getElementById('resultsPage').style.display = 'none';
    wizStep = 0; wizUpdateUI();
    window.scrollTo(0, 0);
    dataLayer.push({ event: 'wizard_start' });
  }
  function backToLanding() {
    document.getElementById('wizardPage').style.display = 'none';
    document.getElementById('resultsPage').style.display = 'none';
    document.getElementById('landingPage').style.display = 'block';
    window.scrollTo(0, 0);
  }
  function showResults() {
    document.getElementById('landingPage').style.display = 'none';
    document.getElementById('wizardPage').style.display = 'none';
    document.getElementById('resultsPage').style.display = 'block';
    window.scrollTo(0, 0);
  }

  /* ============================================
     WIZARD LOGIC
     ============================================ */
  var wizStep = 0;
  var wizTotal = 4;
  var lastResult = null;
  var lastProfile = null;

  function wizUpdateUI() {
    document.querySelectorAll('.wizard-panel').forEach(function(p,i) {
      p.classList.toggle('active', i === wizStep);
    });
    document.querySelectorAll('.wizard-step-dot').forEach(function(d,i) {
      d.classList.remove('active','done');
      if (i < wizStep) d.classList.add('done');
      if (i === wizStep) d.classList.add('active');
    });
  }

  function wizNext() {
    if (wizStep < wizTotal - 1) { wizStep++; wizUpdateUI(); dataLayer.push({ event: 'wizard_step', step: wizStep }); }
  }
  function wizPrev() {
    if (wizStep > 0) { wizStep--; wizUpdateUI(); }
  }

  function getProfile() {
    return {
      eta: parseInt(document.getElementById('wiz-eta').value) || 35,
      residenza: document.getElementById('wiz-residenza').value,
      comune: '',
      stato_civile: document.getElementById('wiz-stato-civile').value,
      occupazione: document.getElementById('wiz-occupazione').value,
      numero_figli: parseInt(document.getElementById('wiz-figli').value) || 0,
      figli_minorenni: parseInt(document.getElementById('wiz-figli-min').value) || 0,
      figli_under3: parseInt(document.getElementById('wiz-figli-u3').value) || 0,
      disabilita: document.getElementById('wiz-disabilita').checked,
      over65: parseInt(document.getElementById('wiz-over65').value) || 0,
      isee: parseFloat(document.getElementById('wiz-isee').value) || 0,
      reddito_annuo: parseFloat(document.getElementById('wiz-reddito').value) || 0,
      affittuario: document.getElementById('wiz-affittuario').checked,
      prima_abitazione: document.getElementById('wiz-prima-abitazione').checked,
      ristrutturaz_casa: document.getElementById('wiz-ristrutturazione').checked,
      studente: document.getElementById('wiz-studente').checked,
      nuovo_nato_2025: document.getElementById('wiz-nuovo-nato').checked
    };
  }

  function wizSubmit() {
    var btn = document.getElementById('wizSubmitBtn');
    btn.disabled = true;
    btn.textContent = 'Analisi in corso...';

    lastProfile = getProfile();

    var matchHeaders = { 'Content-Type': 'application/json' };
    if (turnstileToken) matchHeaders['X-Turnstile-Token'] = turnstileToken;

    fetch('/api/match', {
      method: 'POST',
      headers: matchHeaders,
      body: JSON.stringify(lastProfile)
    })
    .then(function(r) {
      if (!r.ok) throw new Error('Errore ' + r.status);
      return r.json();
    })
    .then(function(data) {
      lastResult = data;
      renderResults(data);
      showResults();
      dataLayer.push({ event: 'match_complete', bonus_count: data.bonus_trovati, risparmio: data.risparmio_stimato });
    })
    .catch(function(err) {
      alert('Errore nella verifica: ' + err.message);
    })
    .finally(function() {
      btn.disabled = false;
      btn.innerHTML = '<span class="icon icon-sm"><svg><use href="#ico-zap"/></svg></span> Verifica bonus';
    });
  }

  /* ============================================
     RESULTS RENDERING
     ============================================ */
  var tabIcons = {
    'tutti': 'ico-list', 'famiglia': 'ico-users', 'casa': 'ico-home',
    'salute': 'ico-shield', 'istruzione': 'ico-edit', 'spesa': 'ico-wallet',
    'lavoro': 'ico-zap', 'sostegno': 'ico-users', 'trasporti': 'ico-home', 'altro': 'ico-zap'
  };
  var tabLabels = {
    'tutti': 'Tutti', 'famiglia': 'Famiglia', 'casa': 'Casa', 'salute': 'Salute',
    'istruzione': 'Istruzione', 'spesa': 'Spesa', 'lavoro': 'Lavoro',
    'sostegno': 'Sostegno', 'trasporti': 'Trasporti', 'altro': 'Altro'
  };
  var activeFilter = 'tutti';

  function renderResults(data) {
    var attivi = data.bonus_attivi || data.bonus.filter(function(b){return !b.scaduto;}).length;
    var scaduti = data.bonus_scaduti || data.bonus.filter(function(b){return b.scaduto;}).length;

    document.getElementById('results-saving').textContent = data.risparmio_stimato || 'EUR 0';
    var countEl = document.getElementById('results-count');
    countEl.textContent = attivi + ' bonus disponibil' + (attivi === 1 ? 'e' : 'i');

    // Expired count
    var oldExpPill = document.getElementById('results-expired-pill');
    if (oldExpPill) oldExpPill.remove();
    if (scaduti > 0) {
      var expPill = document.createElement('div');
      expPill.id = 'results-expired-pill';
      expPill.className = 'bonus-count-expired';
      expPill.textContent = '+ ' + scaduti + ' scadut' + (scaduti === 1 ? 'o' : 'i');
      document.getElementById('resultsHero').appendChild(expPill);
    }

    // Set print date
    var printDateEl = document.getElementById('printDate');
    if (printDateEl) {
      printDateEl.textContent = new Date().toLocaleDateString('it-IT', { day: '2-digit', month: '2-digit', year: 'numeric' });
    }

    // Build tab bar
    var counts = { tutti: data.bonus.length };
    data.bonus.forEach(function(b) {
      if (!b.scaduto) {
        var c = b.categoria || 'altro';
        counts[c] = (counts[c] || 0) + 1;
      }
    });
    var categories = ['tutti'];
    data.bonus.forEach(function(b) {
      if (!b.scaduto) {
        var c = b.categoria || 'altro';
        if (categories.indexOf(c) === -1) categories.push(c);
      }
    });

    activeFilter = 'tutti';
    var tabs = document.getElementById('resultsTabs');
    tabs.innerHTML = '';
    categories.forEach(function(cat) {
      var icon = tabIcons[cat] || 'ico-zap';
      var label = tabLabels[cat] || cat.charAt(0).toUpperCase() + cat.slice(1);
      var count = counts[cat] || 0;
      tabs.innerHTML += '<button class="tab-btn' + (cat === 'tutti' ? ' active' : '') + '" data-cat="' + cat + '" onclick="filterBonus(\'' + cat + '\')">' +
        '<svg class="tab-icon"><use href="#' + icon + '"/></svg>' +
        '<span>' + label + '</span>' +
        '<span class="tab-count">' + count + '</span></button>';
    });
    // Expired tab
    if (scaduti > 0) {
      tabs.innerHTML += '<button class="tab-btn" data-cat="scaduti" onclick="filterBonus(\'scaduti\')"><svg class="tab-icon"><use href="#ico-clock"/></svg><span>Scaduti</span><span class="tab-count tab-count--expired">' + scaduti + '</span></button>';
    }

    renderBonusCards(data.bonus, 'tutti');
  }

  function filterBonus(cat) {
    activeFilter = cat;
    document.querySelectorAll('.tab-btn').forEach(function(b) {
      b.classList.toggle('active', b.dataset.cat === cat);
    });
    var filtered;
    if (cat === 'tutti') {
      filtered = lastResult.bonus;
    } else if (cat === 'scaduti') {
      filtered = lastResult.bonus.filter(function(b) { return b.scaduto; });
    } else {
      filtered = lastResult.bonus.filter(function(b) { return !b.scaduto && (b.categoria || 'altro') === cat; });
    }
    renderBonusCards(filtered, cat);
  }

  function renderBonusCards(bonuses, activeCat) {
    var grid = document.getElementById('bonusGrid');
    grid.innerHTML = '';
    var shownExpiredSep = false;

    bonuses.forEach(function(b, idx) {
      var cardId = 'bonus-card-' + idx;

      // Expired separator
      if (b.scaduto && !shownExpiredSep && activeCat !== 'scaduti') {
        shownExpiredSep = true;
        grid.innerHTML += '<div class="expired-separator"><div class="expired-separator-line"></div><span class="expired-separator-text"><svg class="tab-icon" style="width:14px;height:14px"><use href="#ico-clock"/></svg> Bonus scaduti</span><div class="expired-separator-line"></div></div>';
      }

      var compatClass = b.compatibilita >= 80 ? 'high' : (b.compatibilita >= 50 ? 'med' : 'low');
      var html = '<div class="bonus-card' + (b.scaduto ? ' bonus-card--expired' : '') + '" id="' + cardId + '" data-bonus-id="' + esc(b.id || '') + '">';

      // Card header
      html += '<div class="bonus-card-header">';

      // Title row: dot + name + badges + compat badge
      html += '<div class="bonus-title-row">';
      html += '<span class="compat-dot ' + compatClass + '"></span>';
      html += '<span class="bonus-name">' + esc(b.nome);
      if (b.regioni && b.regioni.length > 0) {
        html += ' <span class="badge-regionale">' + esc(b.regioni[0]) + '</span>';
      }
      if (b.scaduto) {
        html += ' <span class="badge-scaduto">SCADUTO</span>';
      }
      html += '</span>';
      html += '<span class="compat-badge ' + compatClass + '">' + b.compatibilita + '%</span>';
      html += '</div>';

      // Meta row: ente + scadenza
      html += '<div class="bonus-meta-row">';
      html += '<span class="bonus-ente">' + esc(b.ente || '') + '</span>';
      if (b.scadenza) {
        html += '<span class="bonus-meta-sep"></span>';
        html += '<span class="bonus-scadenza' + (b.scaduto ? '' : ' active') + '">' + esc(b.scadenza) + '</span>';
      }
      html += '</div>';

      // Importo box — anti-duplication logic
      var lStimato = (currentTranslations && currentTranslations['results.importo_reale']) || 'Stimato per te';
      var hasStimato = b.importo_reale && b.importo_reale !== b.importo;
      html += '<div class="bonus-importo-box">';
      if (hasStimato) {
        html += '<span class="importo-main">' + esc(b.importo_reale) + '</span>';
        html += '<span class="importo-label">' + esc(lStimato) + '</span>';
        html += '<div class="importo-range">Range: ' + esc(b.importo) + '</div>';
      } else {
        html += '<span class="importo-main">' + esc(b.importo || '') + '</span>';
      }
      html += '</div>';

      // Description
      html += '<p class="bonus-desc">' + esc(b.descrizione || '') + '</p>';

      html += '</div>'; // bonus-card-header

      // Accordion toggle
      var lExpand = (currentTranslations && currentTranslations['results.expand']) || 'Vedi dettagli';
      html += '<button class="bonus-toggle" onclick="toggleDetails(\'' + cardId + '\')"><span>' + esc(lExpand) + '</span><svg class="chevron" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"/></svg></button>';

      // Details
      html += '<div class="bonus-details" id="' + cardId + '-details">';

      // Requisiti
      var lRequisiti = (currentTranslations && currentTranslations['results.requisiti']) || 'Requisiti';
      var lComeFare = (currentTranslations && currentTranslations['results.come_fare']) || 'Come fare domanda';
      var lDocumenti = (currentTranslations && currentTranslations['results.documenti']) || 'Documenti necessari';
      var lFaq = (currentTranslations && currentTranslations['results.faq']) || 'Domande frequenti';

      if (b.requisiti && b.requisiti.length > 0) {
        html += '<div class="detail-section"><div class="detail-section-title">' + esc(lRequisiti) + '</div><ul class="req-list">';
        b.requisiti.forEach(function(r) { html += '<li class="req-item">' + esc(r) + '</li>'; });
        html += '</ul></div>';
      }

      // Come fare domanda
      if (b.come_richiederlo && b.come_richiederlo.length > 0) {
        html += '<div class="detail-section"><div class="detail-section-title">' + esc(lComeFare) + '</div><ul class="steps-list">';
        b.come_richiederlo.forEach(function(s, si) {
          html += '<li class="step-item"><span class="step-num">' + (si+1) + '</span><span>' + esc(s) + '</span></li>';
        });
        html += '</ul></div>';
      }

      // Documenti
      if (b.documenti && b.documenti.length > 0) {
        html += '<div class="detail-section"><div class="detail-section-title">' + esc(lDocumenti) + '</div><ul class="doc-list">';
        b.documenti.forEach(function(d, di) {
          html += '<li class="doc-item" data-doc-idx="' + di + '" onclick="toggleDoc(this)"><span class="doc-checkbox"></span><span class="doc-label">' + esc(d) + '</span></li>';
        });
        html += '</ul></div>';
      }

      // FAQ
      if (b.faq && b.faq.length > 0) {
        html += '<div class="detail-section"><div class="detail-section-title">' + esc(lFaq) + '</div><ul class="faq-list">';
        b.faq.forEach(function(f) {
          html += '<li class="faq-item"><button class="faq-question" onclick="toggleFaq(this)"><span>' + esc(f.domanda) + '</span><svg class="faq-chevron" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"/></svg></button><div class="faq-answer">' + esc(f.risposta) + '</div></li>';
        });
        html += '</ul></div>';
      }

      // Verifica manuale
      if (b.verifica_manuale_necessaria) {
        html += '<div class="bonus-verifica"><span class="icon icon-sm"><svg><use href="#ico-alert"/></svg></span> Dato inserito manualmente. <a href="' + safeURL(b.link_ricerca || b.link_ufficiale) + '" target="_blank" rel="noopener">Verifica sul sito della regione</a></div>';
      }

      html += '</div>'; // bonus-details

      // Card footer: verification + CTA button (compact, one line)
      var lVaiSito = (currentTranslations && currentTranslations['results.link_ufficiale']) || 'Vai al sito';
      html += '<div class="bonus-card-footer">';
      if (b.link_verificato && b.link_ufficiale) {
        var footerDate = formatDateIT(b.link_verificato_al || b.ultimo_aggiornamento);
        var footerEnte = b.fonte_nome || b.ente || '';
        html += '<div class="link-verified"><span class="icon"><svg><use href="#ico-check-circle"/></svg></span><span>Verificato</span>';
        if (footerDate) html += '<span class="date">' + footerDate + '</span>';
        if (footerEnte) html += '<span class="date">&middot; ' + esc(footerEnte) + '</span>';
        html += '</div>';
        html += '<a href="' + safeURL(b.link_ufficiale) + '" target="_blank" rel="noopener" class="btn-sito-ufficiale">' + esc(lVaiSito) + ' <span class="icon"><svg><use href="#ico-external"/></svg></span></a>';
      } else if (b.link_ricerca) {
        html += '<div class="link-warn-footer"><span class="icon"><svg><use href="#ico-alert"/></svg></span><span>Link non verificato</span></div>';
        html += '<a href="' + safeURL(b.link_ricerca) + '" target="_blank" rel="noopener" class="btn-sito-ufficiale">Cerca su sito <span class="icon"><svg><use href="#ico-external"/></svg></span></a>';
      } else if (b.link_ufficiale) {
        html += '<div></div>';
        html += '<a href="' + safeURL(b.link_ufficiale) + '" target="_blank" rel="noopener" class="btn-sito-ufficiale">' + esc(lVaiSito) + ' <span class="icon"><svg><use href="#ico-external"/></svg></span></a>';
      }
      html += '</div>';

      // Expired note
      if (b.scaduto) {
        html += '<div class="expired-note"><span class="icon icon-sm"><svg><use href="#ico-clock"/></svg></span> Questo bonus non è più disponibile</div>';
      }

      html += '</div>'; // bonus-card

      grid.innerHTML += html;
    });

    // Restore document check states from sessionStorage
    document.querySelectorAll('.doc-item').forEach(function(el) {
      var card = el.closest('.bonus-card');
      if (!card) return;
      var bonusId = card.dataset.bonusId;
      var docIdx = el.dataset.docIdx;
      var key = 'bpm_doc_' + bonusId + '_' + docIdx;
      if (sessionStorage.getItem(key)) el.classList.add('checked');
    });
  }

  function esc(s) {
    if (!s) return '';
    var d = document.createElement('div');
    d.appendChild(document.createTextNode(s));
    return d.innerHTML;
  }

  function safeURL(url) {
    if (!url) return '#';
    var s = String(url).trim();
    if (s.indexOf('https://') === 0 || s.indexOf('http://') === 0 || s.indexOf('/') === 0) {
      return esc(s);
    }
    return '#';
  }

  function formatDateIT(dateStr) {
    if (!dateStr) return '';
    var d = new Date(dateStr);
    if (isNaN(d.getTime())) {
      // Try DD/MM/YYYY passthrough
      if (/^\d{2}\/\d{2}\/\d{4}$/.test(dateStr)) return dateStr;
      return '';
    }
    var dd = String(d.getDate()).padStart(2, '0');
    var mm = String(d.getMonth() + 1).padStart(2, '0');
    var yyyy = d.getFullYear();
    return dd + '/' + mm + '/' + yyyy;
  }

  function toggleDetails(cardId) {
    var det = document.getElementById(cardId + '-details');
    var btn = det.previousElementSibling;
    var isOpen = det.classList.toggle('show');
    btn.classList.toggle('open', isOpen);
    btn.querySelector('span').textContent = isOpen ? 'Nascondi dettagli' : 'Vedi dettagli';
  }

  function toggleFaq(btn) {
    var answer = btn.nextElementSibling;
    var isOpen = btn.classList.contains('open');
    // Close all in same section
    var section = btn.closest('.detail-section');
    if (section) {
      section.querySelectorAll('.faq-question.open').forEach(function(q) {
        q.classList.remove('open');
        q.nextElementSibling.classList.remove('show');
      });
    }
    if (!isOpen) {
      btn.classList.add('open');
      answer.classList.add('show');
    }
  }

  function toggleDoc(el) {
    el.classList.toggle('checked');
    var card = el.closest('.bonus-card');
    if (!card) return;
    var bonusId = card.dataset.bonusId;
    var docIdx = el.dataset.docIdx;
    var key = 'bpm_doc_' + bonusId + '_' + docIdx;
    if (el.classList.contains('checked')) {
      sessionStorage.setItem(key, '1');
    } else {
      sessionStorage.removeItem(key);
    }
  }

  /* ============================================
     ACTIONS
     ============================================ */
  function downloadReport(mode) {
    if (!lastProfile) return;
    dataLayer.push({ event: mode === 'print' ? 'pdf_print' : 'pdf_download' });
    var url = '/api/report' + (mode === 'print' ? '?mode=inline' : '');
    var form = document.createElement('form');
    form.method = 'POST';
    form.action = url;
    form.target = mode === 'print' ? '_blank' : '';
    var input = document.createElement('input');
    input.type = 'hidden';
    input.name = 'data';
    input.value = JSON.stringify(lastProfile);
    form.appendChild(input);
    document.body.appendChild(form);
    form.submit();
    document.body.removeChild(form);
  }

  function exportCalendar() {
    if (!lastResult || !lastResult.bonus) return;
    dataLayer.push({ event: 'calendar_export' });
    var items = lastResult.bonus.filter(function(b) { return b.scadenza; }).map(function(b) {
      return { nome: b.nome, scadenza: b.scadenza };
    });
    if (items.length === 0) { alert('Nessuna scadenza da esportare'); return; }
    var url = '/api/calendar?bonuses=' + encodeURIComponent(JSON.stringify(items));
    window.location.href = url;
  }

  function backToWizard() {
    document.getElementById('resultsPage').style.display = 'none';
    document.getElementById('wizardPage').style.display = 'flex';
    window.scrollTo(0, 0);
  }

  function shareWhatsApp() {
    if (!lastResult) return;
    dataLayer.push({ event: 'whatsapp_share' });
    var waText = 'Ho scoperto che ho diritto a ' + lastResult.bonus_trovati + ' bonus per un risparmio di ' + (lastResult.risparmio_stimato || 'EUR 0') + '. Verifica anche tu su BonusPerMe.it!';
    window.open('https://wa.me/?text=' + encodeURIComponent(waText), '_blank');
  }

  /* ============================================
     ISEE PDF UPLOAD
     ============================================ */
  var uploadZone = document.getElementById('iseeUploadZone');
  var iseeFileInput = document.getElementById('iseeFile');

  uploadZone.addEventListener('click', function() { iseeFileInput.click(); });
  uploadZone.addEventListener('dragover', function(e) { e.preventDefault(); uploadZone.style.borderColor = 'var(--blue-mid)'; });
  uploadZone.addEventListener('dragleave', function() { uploadZone.style.borderColor = ''; });
  uploadZone.addEventListener('drop', function(e) {
    e.preventDefault();
    uploadZone.style.borderColor = '';
    if (e.dataTransfer.files.length > 0) handleISEEFile(e.dataTransfer.files[0]);
  });
  iseeFileInput.addEventListener('change', function() {
    if (iseeFileInput.files.length > 0) handleISEEFile(iseeFileInput.files[0]);
  });

  /* ============================================
     COOKIE CONSENT
     ============================================ */
  (function() {
    var consent = localStorage.getItem('cookie_consent');
    if (!consent) {
      document.getElementById('cookieBanner').style.display = 'block';
    }
  })();
  function acceptCookies() {
    localStorage.setItem('cookie_consent', 'accepted');
    document.getElementById('cookieBanner').style.display = 'none';
    loadGTM();
    dataLayer.push({ event: 'cookie_consent', consent: 'accepted' });
  }
  function rejectCookies() {
    localStorage.setItem('cookie_consent', 'rejected');
    document.getElementById('cookieBanner').style.display = 'none';
    dataLayer.push({ event: 'cookie_consent', consent: 'rejected' });
  }

  /* ============================================
     DYNAMIC COUNTER
     ============================================ */
  fetch('/api/stats')
    .then(function(r) { return r.json(); })
    .then(function(data) {
      if (data.scansioni) {
        var el = document.getElementById('proofCounter');
        if (el) el.textContent = Number(data.scansioni).toLocaleString('it-IT');
      }
    })
    .catch(function() {});

  /* ============================================
     TURNSTILE
     ============================================ */
  var turnstileToken = '';
  function onTurnstileSuccess(token) { turnstileToken = token; }

  /* ============================================
     SOCIAL PROOF TOAST
     ============================================ */
  var spCities = ['Roma','Milano','Napoli','Torino','Palermo','Genova','Bologna','Firenze','Bari','Catania','Venezia','Verona','Padova','Brescia','Parma','Cagliari'];
  var spMessages = [
    'Una famiglia di {city} ha appena scoperto 3 bonus',
    '{n} famiglie oggi hanno usato BonusPerMe',
    'Una mamma di {city} ha trovato €2.400 di bonus',
    'Nuova verifica completata da {city}'
  ];
  var spTimer = null;

  function initSocialProof() {
    if (sessionStorage.getItem('bpm_sp_closed')) return;
    var delay = 15000 + Math.random() * 10000;
    spTimer = setTimeout(showSocialProof, delay);
  }

  function showSocialProof() {
    if (sessionStorage.getItem('bpm_sp_closed')) return;
    if (document.getElementById('wizardPage').style.display !== 'none') {
      spTimer = setTimeout(showSocialProof, 10000);
      return;
    }
    var city = spCities[Math.floor(Math.random() * spCities.length)];
    var n = 40 + Math.floor(Math.random() * 60);
    var msgs = spMessages;
    if (currentTranslations && currentTranslations['social_proof.msg1']) {
      msgs = [
        currentTranslations['social_proof.msg1'],
        currentTranslations['social_proof.msg2'],
        currentTranslations['social_proof.msg3'],
        currentTranslations['social_proof.msg4']
      ];
    }
    var msg = msgs[Math.floor(Math.random() * msgs.length)];
    msg = msg.replace('{city}', city).replace('{n}', n);

    var el = document.getElementById('socialProofToast');
    el.querySelector('.sp-text').textContent = msg;
    el.classList.add('show');

    setTimeout(function() {
      el.classList.remove('show');
    }, 6000);

    var next = 45000 + Math.random() * 45000;
    spTimer = setTimeout(showSocialProof, next);
  }

  function closeSocialProof() {
    var el = document.getElementById('socialProofToast');
    el.classList.remove('show');
    sessionStorage.setItem('bpm_sp_closed', '1');
    if (spTimer) clearTimeout(spTimer);
  }

  initSocialProof();

  function handleISEEFile(file) {
    var status = document.getElementById('iseeUploadStatus');
    status.style.display = 'block';
    status.style.color = 'var(--blue-mid)';
    status.textContent = 'Analisi PDF in corso...';

    var fd = new FormData();
    fd.append('file', file);

    fetch('/api/parse-isee', { method: 'POST', body: fd })
    .then(function(r) { return r.json(); })
    .then(function(data) {
      if (data.found && data.isee > 0) {
        document.getElementById('wiz-isee').value = data.isee;
        status.style.color = 'var(--green)';
        status.textContent = 'ISEE trovato: EUR ' + data.isee.toLocaleString('it-IT');
      } else {
        status.style.color = 'var(--amber)';
        status.textContent = 'ISEE non trovato nel PDF. Inseriscilo manualmente.';
      }
    })
    .catch(function() {
      status.style.color = 'var(--terra)';
      status.textContent = 'Errore lettura PDF.';
    });
  }
</script>

<!-- Social Proof Toast -->
<style>
.social-proof{position:fixed;bottom:24px;left:24px;z-index:900;background:#fff;border:1px solid var(--ink-15);border-radius:var(--radius-lg);box-shadow:var(--shadow-dropdown);padding:14px 40px 14px 16px;max-width:360px;transform:translateY(120%);opacity:0;transition:transform .4s ease,opacity .3s ease;pointer-events:none}
.social-proof.show{transform:translateY(0);opacity:1;pointer-events:auto}
.social-proof .sp-dot{display:inline-block;width:8px;height:8px;background:var(--green);border-radius:50%;margin-right:8px;animation:sp-pulse 2s infinite}
.social-proof .sp-text{font-size:.85rem;color:var(--ink-75)}
.social-proof .sp-close{position:absolute;top:8px;right:10px;background:none;border:none;font-size:1rem;color:var(--ink-30);cursor:pointer;line-height:1}
@keyframes sp-pulse{0%,100%{opacity:1}50%{opacity:.4}}
@media(max-width:480px){.social-proof{left:12px;right:12px;max-width:none;bottom:12px}}
</style>
<div class="social-proof" id="socialProofToast">
  <span class="sp-dot"></span>
  <span class="sp-text"></span>
  <button class="sp-close" onclick="closeSocialProof()">&times;</button>
</div>

</body>
</html>
